var game;(function(game){var util;(function(util){class PubUtil{constructor(){}static GetTodayDateStr(){var date=new Date;return date.getFullYear()+""+(date.getMonth()+1)+""+date.getDate()}static getGrayFilter(){let colorMatrix=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0];let ColorFilter=new Laya.ColorFilter(colorMatrix);return ColorFilter}static getRedFilter(){let colorMatrix=[1,0,0,0,255,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0];let ColorFilter=new Laya.ColorFilter(colorMatrix);return ColorFilter}static setNumber(arrNumber,index,defaultValue){return arrNumber&&arrNumber.length>index?arrNumber[index]:arrNumber[index]=defaultValue}static setString(arrString,index,defaultValue){return arrString&&arrString.length>index?arrString[index]:arrString[index]=defaultValue}static isEmpty(input){let myreg=/^[ ]*$/;if(myreg.test(input)){return true}else{return false}}static isNumber(input){let myreg=/^[0-9]+.?[0-9]*$/;if(myreg.test(input)){return true}else{return false}}static isTel(input){let myreg=/^[1][3,4,5,7,8][0-9]{9}$/;if(myreg.test(input)){return true}else{return false}}static isMail(input){let myreg=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(myreg.test(input)){return true}else{return false}}}util.PubUtil=PubUtil})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var util;(function(util){class ProxyUtil{constructor(){}static regProxy(target,propName,callBack){Object.defineProperty(target,propName,{get:()=>{return target[propName]},set:v=>{let old=target[propName];target[propName]=v;if(callBack){callBack(old,v)}}})}}util.ProxyUtil=ProxyUtil})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var util;(function(util){class MathUtil{constructor(){}static randomRange(min,max){return Math.floor(Math.random()*(max-min+1)+min)}static isOverlap(rect1,rect2){const startX1=rect1.x,startY1=rect1.y,endX1=startX1+rect1.width,endY1=startY1+rect1.height;const startX2=rect2.x,startY2=rect2.y,endX2=startX2+rect2.width,endY2=startY2+rect2.height;return!(endY2<startY1||endY1<startY2||startX1>endX2||startX2>endX1)}static angleToRadian(angle){return angle*Math.PI/180}static radianToAngle(radian){return radian*180/Math.PI}static getTwoPointAngle(fromX,fromY,toX,toY){let radian=Math.atan2(fromY-toY,fromX-toX);let angle=MathUtil.radianToAngle(radian);return angle}static getFromAngle(fromAngle){return fromAngle+180}static changeAngle360(angle){angle=angle%360;if(angle<0){angle+=360}return angle}static getDirByRotate(rotate){let ret=ActionDirect.Right;if(rotate>22.5&&rotate<=67.5){ret=ActionDirect.Right_down}else if(rotate>67.5&&rotate<=112.5){ret=ActionDirect.Down}else if(rotate>112.5&&rotate<=157.5){ret=ActionDirect.Left_down}else if(rotate>157.5&&rotate<=202.5){ret=ActionDirect.Left}else if(rotate>202.5&&rotate<=247.5){ret=ActionDirect.Left_up}else if(rotate>247.5&&rotate<=292.5){ret=ActionDirect.Up}else if(rotate>292.5&&rotate<=337.5){ret=ActionDirect.Right_up}else{ret=ActionDirect.Right}return ret}static CreateBezierPoints(anchorpoints,pointsAmount){var points=[];for(var i=0;i<pointsAmount;i++){var point=this.MultiPointBezier(anchorpoints,i/pointsAmount);points.push(point)}return points}static MultiPointBezier(points,t){let len=points.length;let x=0,y=0;for(let i=0;i<len;i++){let point=points[i];x+=point.x*Math.pow(1-t,len-1-i)*Math.pow(t,i)*this.erxiangshi(len-1,i);y+=point.y*Math.pow(1-t,len-1-i)*Math.pow(t,i)*this.erxiangshi(len-1,i)}return{x:x,y:y}}static erxiangshi(start,end){let cs=1,bcs=1;while(end>0){cs*=start;bcs*=end;start--;end--}return cs/bcs}static getDistance(p1,p2){let dx=p2.x-p1.x;let dy=p2.y-p1.y;let distance=Math.sqrt(dx*dx+dy*dy);return distance}}util.MathUtil=MathUtil;class Size{constructor(x=0,y=0,w=0,h=0){this.x=x;this.y=y;this.w=w;this.h=h}}util.Size=Size})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var util;(function(util){class Dictionary{constructor(){this._container=new Object;this._length=0}get container(){return this._container}get length(){return this._length}add(key,value){if(!this.hasKey(key))this._length++;this._container[key]=value;return value}forEach(func){var boo;for(let i in this._container){boo=func(this._container[i]);if(!boo){return}}}forIn(func){for(let i in this._container){func(i)}}valueOf(){var values=[];for(let i in this._container){values.push(this._container[i])}return values}get(key){return this._container[key]}reset(key,value){if(this.hasKey(key)){this._container[key]=value}else{console.log("ObjDictionary: warning you reset a not exist key")}}hasKey(key){return this._container.hasOwnProperty(key)}remove(key){if(this._container.hasOwnProperty(key)){let value=this._container[key];this._container[key]=null;delete this._container[key];this._length--;return value}return null}clear(){this._length=0;this._container=null;this._container=new Object}}util.Dictionary=Dictionary})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class UIType{constructor(v,v2){this.name=v;this.path=v2}}ui.UIType=UIType})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class UIScaleManager{constructor(){if(UIScaleManager._ins!=null)throw new Error("UIScaleManager is single!")}static get ins(){if(!this._ins)UIScaleManager._ins=new UIScaleManager;return this._ins}init(){this.dicWindow=new Dictionary;EventManager.ins.on(NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE,this,this.SYS_SCREEN_HORIZONTAL_ONSIZE);EventManager.ins.on(NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE,this,this.SYS_SCREEN_VERTICAL_ONSIZE);this.autoScale()}regUI(name,scaleH,scaleV){if(!this.dicWindow){console.error("UIScaleManager.ts 未进行初始化！");return}let arrFunc=this.dicWindow.get(name);if(!arrFunc){arrFunc=new Array;this.dicWindow.add(name,arrFunc)}arrFunc[0]=scaleH;arrFunc[1]=scaleV}autoScale(){if(game.Define.isVertitalState){this.SYS_SCREEN_VERTICAL_ONSIZE()}else{this.SYS_SCREEN_HORIZONTAL_ONSIZE()}}SYS_SCREEN_HORIZONTAL_ONSIZE(){for(let arrFunc of this.dicWindow.valueOf()){if(arrFunc){if(arrFunc[0]){arrFunc[0]()}}}}SYS_SCREEN_VERTICAL_ONSIZE(){for(let arrFunc of this.dicWindow.valueOf()){if(arrFunc){if(arrFunc[1]){arrFunc[1]()}}}}}ui.UIScaleManager=UIScaleManager})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class UIManager{constructor(){if(UIManager._ins!=null)throw new Error("UIManager is single!")}static get ins(){if(!this._ins)UIManager._ins=new UIManager;return this._ins}init(){this.topView=LayerManager.ins.addChild(new Laya.Sprite,LayerName.ui_effect);this.topMask=new Laya.Sprite;this.topView.addChild(this.topMask);this.dicWindow=new Dictionary;ui.UIScaleManager.ins.init()}getWindow(uiType){var win=this.dicWindow.get(uiType.name);if(!win){var cls=uiType.path;win=new cls;win.uiType=uiType;this.dicWindow.add(uiType.name,win)}return win}openWindow(uiType){var win=this.getWindow(uiType);if(win.isOpen()){}else{LayerManager.ins.addChild(win,LayerName.ui_window);if(uiType.name=="gameDownload"){if(game.Global.platformId==PlatformID.Vg){if(parent){parent.postMessage("complete","*");console.log("vungle 调用 parent.postMessage('complete','*')")}}}}return win}closeWindow(uiType){var win=this.dicWindow.get(uiType.name);if(win){win.removeSelf()}}addTop(sp){this.topView.addChild(sp)}drawTopMask(size,alpha=.5){let topMask=this.topMask;if(!size){topMask.graphics.clear();return}let x=size.x;let y=size.y;let w=size.w;let h=size.h;topMask.graphics.drawRect(0,0,game.Define.DeviceW,y,"#000000");topMask.graphics.drawRect(0,y,x,h,"#000000");topMask.graphics.drawRect(x+w,y,game.Define.DeviceW-(x+w),h,"#000000");topMask.graphics.drawRect(0,y+h,game.Define.DeviceW,game.Define.DeviceH-(y+h),"#000000");topMask.alpha=alpha}addTopBtnSound(btnSound){if(!btnSound){return}LayerManager.ins.addChild(btnSound,LayerName.top);btnSound.on(Laya.Event.CLICK,this,()=>{if(btnSound.gray){btnSound.gray=false;SoundManager.ins.setOn(true)}else{btnSound.gray=true;SoundManager.ins.setOn(false)}})}}ui.UIManager=UIManager})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){class TouchManager{constructor(){this.mouseSpeed=1;this.maxMoveCount=0;this._isCanTouch=true;this._isTouch=false;if(TouchManager._ins!=null)throw new Error("TouchManager is single!");TouchManager._ins=this;this._startPoint=new Laya.Point;this._curPoint=new Laya.Point}static get ins(){if(!this._ins)new TouchManager;return this._ins}init(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown);this.AngleToDirectionMap=[ActionDirect.Right,ActionDirect.Down,ActionDirect.Left,ActionDirect.Up,ActionDirect.Right]}set isCanTouch(v){this._isCanTouch=v;if(!this._isCanTouch&&this._isTouch){this.onMouseUp(null)}}get isCanTouch(){return this._isCanTouch}get isTouch(){return this._isTouch}onMouseDown(t){if(!this._isCanTouch){return}Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp);Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.onMouseUp);this._moveCount=0;this._isTouch=true;this._startPoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY);EventManager.ins.event(NoticeEvent.TOUCH,{state:1})}onMouseMove(t){if(this._isTouch){this._curPoint.x=Laya.stage.mouseX;this._curPoint.y=Laya.stage.mouseY;let distance=this._startPoint.distance(this._curPoint.x,this._curPoint.y);if((this.maxMoveCount==0||this._moveCount<this.maxMoveCount)&&distance>=this.mouseSpeed){let radian=Math.atan2(this._curPoint.y-this._startPoint.y,this._curPoint.x-this._startPoint.x);let angle=MathUtil.radianToAngle(radian);angle=MathUtil.changeAngle360(angle);EventManager.ins.event(NoticeEvent.TOUCH_DIRECTOR,{angle:angle.toFixed(2),radian:radian.toFixed(2),dir:this.getSwipeDirection(angle)});this._moveCount++;this._startPoint.setTo(this._curPoint.x,this._curPoint.y)}}}onMouseUp(t){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onMouseUp);Laya.stage.off(Laya.Event.MOUSE_OUT,this,this.onMouseUp);this._isTouch=false;EventManager.ins.event(NoticeEvent.TOUCH,{state:0})}getSwipeDirection(angle){if(angle>45&&angle<135){return ActionDirect.Down}else if(angle>=135&&angle<225){return ActionDirect.Left}else if(angle>=225&&angle<315){return ActionDirect.Up}else{return ActionDirect.Right}}}scene.TouchManager=TouchManager})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var skill;(function(skill_1){class SkillManager{constructor(){if(SkillManager._ins!=null)throw new Error("SkillManager is single!");this.dicSkill=new Dictionary;this.dicKingSkill=new Dictionary}static get ins(){if(!this._ins)SkillManager._ins=new SkillManager;return this._ins}init(){}initData(data){let skills=data;for(let skill of skills){if(skill.atkingCount==0)skill.atkingCount=1;if(skill.atkingCount==1){skill.atkingRotation=0}this.dicSkill.add(skill.skillId,skill);if(!this.dicKingSkill.hasKey(skill.skin)){let arr=[];this.dicKingSkill.add(skill.skin,arr)}this.dicKingSkill.get(skill.skin).push(skill)}console.log("Cfg_Skill 初始化完成")}getCfg(skillId){return this.dicSkill.get(skillId)}getCfgs(){return this.dicSkill.valueOf()}getKingCfg(skin){return this.dicKingSkill.get(skin)}getSkill(skillData){let bs=null;switch(skillData.cfg_Skill.skillType){case skill_1.SkillType.ATTACK:bs=new skill_1.AttackSkill;break;case skill_1.SkillType.BULLET:bs=new skill_1.BulletSkill;break;case skill_1.SkillType.GROUP_SKILL:bs=new skill_1.GroupKillSkill;break;default:console.error("EffectName not exist!");break}if(bs)bs.setData(skillData);return bs}}skill_1.SkillManager=SkillManager})(skill=scene.skill||(scene.skill={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){class SceneManager{constructor(){this.lastClientWidth=0;this.isGameResLoaded=false;this.spBody=null;this.fillScale=.5;this.fillRate=0;this.fillRateWidth=0;this.fillRateHeight=0;this.firstClick=true;this.isLoopMap=false;this.loopMapCount=0;this.loopMapWidth=0;this.loopMapIndex=0;if(SceneManager._ins!=null)throw new Error("SceneManager is single!")}static get ins(){if(!this._ins)SceneManager._ins=new SceneManager;return this._ins}init(){Laya.stage.bgColor=game.Define.BACKGROUND_COLOR;this.scene=scene.LayerManager.ins.getLayer(scene.LayerName.scene);this.mapRoot=scene.LayerManager.ins.getLayer(scene.LayerName.scene_map);this.arrMap=[];KingManager.ins.init();BoneManager.ins.init();this.imgDefault=new Laya.Image;if(game.Define.isSameBackgroundScale){scene.LayerManager.ins.addChild(this.imgDefault,scene.LayerName.scene_map)}else{Laya.stage.addChildAt(this.imgDefault,0)}Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onClick);Laya.stage.on(Laya.Event.FOCUS,this,this.onFocus);Laya.stage.on(Laya.Event.BLUR,this,this.onBlur);Laya.stage.on(Laya.Event.RESIZE,this,this.onResize);Laya.stage.on(Laya.Event.VISIBILITY_CHANGE,this,this.onVisibilityChange);EventManager.ins.on(NoticeEvent.GAME_RES_LOAD_FINISH,this,this.GAME_RES_LOAD_FINISH);this.initStage()}initStage(){EventManager.ins.on(NoticeEvent.SYS_SCREEN_HORIZONTAL,this,this.SCREEN_HORIZONTAL);EventManager.ins.on(NoticeEvent.SYS_SCREEN_VERTICAL,this,this.SCREEN_VERTICAL);EventManager.ins.on(NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE,this,this.SCREEN_HORIZONTAL_ONSIZE);EventManager.ins.on(NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE,this,this.SCREEN_VERTICAL);Laya.stage.screenMode=game.Define.screenMode==1?Stage.SCREEN_VERTICAL:game.Define.screenMode==2?Stage.SCREEN_HORIZONTAL:Stage.SCREEN_NONE;this.checkSize();Laya.timer.frameLoop(1,this,()=>{this.checkSize();this.checkLoopMap()})}onResize(){if(Laya.Browser.clientWidth>Laya.Browser.clientHeight){game.Define.isVertitalState=false;EventManager.ins.event(NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE)}else{game.Define.isVertitalState=true;EventManager.ins.event(NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE)}if(Laya.Browser.onIOS){this.checkSize()}}onClick(e){if(this.firstClick){console.log("第一次点击场景");this.firstClick=false;if(PlatformManager.alPlatform!=null){SoundManager.ins.setOn(true);SoundManager.ins.playMusic(game.Define.SOUND_MAIN)}}else{}}onFocus(e){console.log("获得焦点");EventManager.ins.event(NoticeEvent.SYS_FOCUS,e);Laya.stage.timer.once(200,this,()=>{SoundManager.ins.playMusic(game.Define.SOUND_MAIN)})}onBlur(e){console.log("失去焦点");EventManager.ins.event(NoticeEvent.SYS_BLUR,e)}onVisibilityChange(e){console.log("舞台是否可见："+Laya.stage.isVisibility);if(Laya.stage.isVisibility){this.onFocus(e)}else{this.onBlur(e)}}GAME_RES_LOAD_FINISH(e){this.isGameResLoaded=true;this.checkScreenDirection()}checkSize(){if(this.lastClientWidth!=Laya.Browser.clientWidth){if(Laya.Browser.clientWidth>Laya.Browser.clientHeight){console.log("横屏:"+Laya.Browser.clientWidth);game.Define.isVertitalState=false;EventManager.ins.event(NoticeEvent.SYS_SCREEN_HORIZONTAL)}else{console.log("竖屏:"+Laya.Browser.clientWidth);game.Define.isVertitalState=true;EventManager.ins.event(NoticeEvent.SYS_SCREEN_VERTICAL)}this.lastClientWidth=Laya.Browser.clientWidth}}SCREEN_HORIZONTAL(){this.fillRate=Laya.Browser.clientWidth/game.Define.DeviceW/(Laya.Browser.clientHeight/game.Define.DeviceH);this.checkScreenDirection();this.fillRateHeight=game.Define.DeviceH/(this.fillRate*this.fillScale);this.fillRateWidth=this.fillRateHeight*game.Define.DeviceH/game.Define.DeviceW}SCREEN_VERTICAL(){this.fillRate=Laya.Browser.clientWidth/game.Define.DeviceW/(Laya.Browser.clientHeight/game.Define.DeviceH);this.checkScreenDirection();this.fillRateHeight=game.Define.DeviceW/(this.fillRate*this.fillScale);this.fillRateWidth=this.fillRateHeight*game.Define.DeviceW/game.Define.DeviceH}getRootStageX(x){return x*this.fillScale}getRootStageY(y){return y*this.fillRate*this.fillScale}checkScreenDirection(){if(game.Define.screenMode==1||game.Define.screenMode==2){return}if(game.Define.isVertitalGame==game.Define.isVertitalState){if(this.spBody){this.spBody.visible=false}scene.LayerManager.ins.setScale(1)}else{if(this.spBody){this.spBody.visible=true}else{this.fill()}if(game.Define.screenFillType==ScreenFillType.default){game.Define.isSameScale=true;scene.LayerManager.ins.setScale(game.Define.isVertitalGame?game.Define.DeviceW/game.Define.DeviceH:game.Define.DeviceH/game.Define.DeviceW)}else{scene.LayerManager.ins.setScale(.5)}}}SCREEN_HORIZONTAL_ONSIZE(){}fill(){if(!this.isGameResLoaded){return}if(game.Define.screenFillType==ScreenFillType.default){return}if(!this.spBody){this.spBody=new Laya.Sprite;Laya.stage.addChild(this.spBody);if(game.Define.isVertitalGame){this.spBody.graphics.drawRect(0,0,game.Define.DeviceW>>2,game.Define.DeviceH,game.Define.BACKGROUND_COLOR);this.spBody.graphics.drawRect(game.Define.DeviceW*.75,0,game.Define.DeviceW>>2,game.Define.DeviceH,game.Define.BACKGROUND_COLOR)}else{this.spBody.graphics.drawRect(0,0,game.Define.DeviceW,game.Define.DeviceH>>2,game.Define.BACKGROUND_COLOR);this.spBody.graphics.drawRect(game.Define.DeviceH*.75,0,game.Define.DeviceW,game.Define.DeviceH>>2,game.Define.BACKGROUND_COLOR)}if(game.Define.screenFillType==ScreenFillType.simple){this.fillSimple()}else if(game.Define.screenFillType==ScreenFillType.nice1){this.fillNice1()}else if(game.Define.screenFillType==ScreenFillType.nice2){this.fillNice2()}else{}this.onResize()}}fillSimple(){let scaleX=0;let scaleY=0;if(game.Define.isVertitalGame){let imgLogo=this.createLogo();imgLogo.x=game.Define.DeviceW/8;imgLogo.y=game.Define.DeviceH>>1;let imgDownload=this.createDownload();imgDownload.x=game.Define.DeviceW*.75+game.Define.DeviceW/8;imgDownload.y=game.Define.DeviceH>>1}else{let imgLogo=this.createLogo();imgLogo.x=game.Define.DeviceW>>1;imgLogo.y=game.Define.DeviceH/8;let imgDownload=this.createDownload();imgDownload.x=game.Define.DeviceW>>1;imgDownload.y=game.Define.DeviceH*.75+game.Define.DeviceH/8}}fillNice1(){let scaleX=0;let scaleY=0;if(Laya.loader.getRes("game/img_nice.png")){let imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";scaleX=game.Define.DeviceW/5/imgNice.width;scaleY=scaleX*this.fillRate;imgNice.scaleX=scaleX;imgNice.scaleY=scaleY;imgNice.x=game.Define.DeviceW/40;imgNice.y=game.Define.DeviceH-imgNice.height*scaleY;this.spBody.addChild(imgNice);imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";imgNice.scaleX=scaleX;imgNice.scaleY=scaleY;imgNice.x=game.Define.DeviceW*.75+game.Define.DeviceW/40;imgNice.y=game.Define.DeviceH-imgNice.height*scaleY;this.spBody.addChild(imgNice)}this.fillSimple()}fillNice2(){let scaleX=0;let scaleY=0;if(Laya.loader.getRes("game/img_nice.png")){let imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";scaleX=.7;imgNice.scaleX=scaleX;imgNice.x=imgNice.width*(1-scaleX)/2;imgNice.y=0;this.spBody.addChild(imgNice);imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";imgNice.scaleX=scaleX;imgNice.x=game.Define.DeviceW*.75+imgNice.width*(1-scaleX)/2;imgNice.y=0;this.spBody.addChild(imgNice)}this.fillSimple()}createLogo(){let scaleX=0;let scaleY=0;let imgLogo=new Laya.Image;imgLogo.skin=game.Define.langId==LangType.En?"loading/img_logo.png":"loading/img_logo.png";imgLogo.anchorX=imgLogo.anchorY=.5;scaleX=game.Define.DeviceW/5/imgLogo.width;scaleY=scaleX*this.fillRate;imgLogo.scaleX=scaleX;imgLogo.scaleY=scaleY;imgLogo.x=game.Define.DeviceW/8;imgLogo.y=0;this.spBody.addChild(imgLogo);return imgLogo}createDownload(right=""){let scaleX=0;let scaleY=0;let imgDownload=new Laya.Image;imgDownload.skin=game.Define.langId==LangType.En?"game/btn_download"+right+".png":"game/btn_download"+right+".png";imgDownload.anchorX=imgDownload.anchorY=.5;scaleX=game.Define.DeviceW/5/imgDownload.width;scaleY=scaleX*this.fillRate;imgDownload.scaleX=scaleX;imgDownload.scaleY=scaleY;imgDownload.x=game.Define.DeviceW/8;imgDownload.y=0;this.spBody.addChild(imgDownload);imgDownload.mouseEnabled=true;imgDownload.on(Laya.Event.CLICK,this,()=>{HttpManager.ins.link(game.Define.DOWNLOAD_URL)});return imgDownload}setBackground(url,x=0,y=0,w=-1,h=-1){if(x>0||y>0||w>0||h>0){let map=new Laya.Image;map.x=x;map.y=y;if(w!=-1)map.width=w;if(h!=-1)map.height=h;Base64Manager.ins.checkImg(map,url);if(game.Define.isSameBackgroundScale){scene.LayerManager.ins.addChild(map,scene.LayerName.scene_map)}else{Laya.stage.addChildAt(map,0)}this.arrMap.push(map)}else{Base64Manager.ins.checkImg(this.imgDefault,url)}}clearMapAll(){for(let map of this.arrMap){map.removeSelf()}while(this.mapRoot.numChildren>0){this.mapRoot.getChildAt(0).removeSelf()}this.mapRoot.addChild(this.imgDefault)}setLoopMap(isLoop){this.isLoopMap=isLoop;this.loopMapCount=this.arrMap.length;this.loopMapWidth=this.arrMap[0].width}checkLoopMap(){if(this.isLoopMap){let tempIndex=Math.ceil(this.scene.x/this.loopMapWidth);if(tempIndex<this.loopMapIndex){this.loopMapIndex=tempIndex;let firstMap=this.arrMap.shift();this.arrMap.push(firstMap);firstMap.x=(this.loopMapCount-tempIndex-1)*this.loopMapWidth}else if(tempIndex>this.loopMapIndex){this.loopMapIndex=tempIndex;let lastMap=this.arrMap.pop();this.arrMap.unshift(lastMap);lastMap.x=-tempIndex*this.loopMapWidth}else{}}}}scene.SceneManager=SceneManager;let ScreenFillType;(function(ScreenFillType){ScreenFillType[ScreenFillType["default"]=0]="default";ScreenFillType[ScreenFillType["simple"]=1]="simple";ScreenFillType[ScreenFillType["nice1"]=2]="nice1";ScreenFillType[ScreenFillType["nice2"]=3]="nice2"})(ScreenFillType=scene.ScreenFillType||(scene.ScreenFillType={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){class Scene3DManager{constructor(){this.debugSprites=new Array;if(Scene3DManager._ins!=null)throw new Error("Scene3DManager is single!");if(window["Laya3D"]){this.scene3d=scene.LayerManager.ins.addChild(new Laya.Scene3D,scene.LayerName.scene_king)}}static get ins(){if(!this._ins)Scene3DManager._ins=new Scene3DManager;return this._ins}init(){this.initCamera()}initCamera(){this.camera=this.scene3d.addChild(new Laya.Camera(game.Define.DeviceW/game.Define.DeviceH,.1,1e3));this.camera.transform.translate(new Laya.Vector3(0,10,1));this.camera.transform.rotate(new Laya.Vector3(-5,0,0),true,false);this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY;let directionlight=this.scene3d.addChild(new Laya.DirectionLight);directionlight.diffuseColor=new Laya.Vector3(.6,.6,.6);let mat=directionlight.transform.worldMatrix;mat.setForward(new Laya.Vector3(-1,-1,-1));directionlight.transform.worldMatrix=mat}getScene3D(){if(!this.scene3d){}return this.scene3d}getCamera(){if(!this.camera){}return this.camera}drawRayLine(from,to){if(this.debugSprites.length>0){for(let i=0,n=this.debugSprites.length;i<n;i++)this.debugSprites[i].destroy();this.debugSprites.length=0}}addBox(){}addSphere(){}addCapsule(){}addCone(){}addCylinder(){}}scene.Scene3DManager=Scene3DManager})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){class RockerManager{constructor(){this.mouseSpeed=1;this.maxMoveCount=0;this.isCanTouch=true;this._isTouch=false;this.radis=0;this.isFollow=false;this.lastTime=0;if(RockerManager._ins!=null)throw new Error("RockerManager is single!");RockerManager._ins=this;this.initPoint=new Laya.Point;this.startPoint=new Laya.Point;this.curPoint=new Laya.Point;this.lastPoint=new Laya.Point;this.rockerArea=new Laya.Image;this.rockerArea.mouseEnabled=true;this.rockerArea.alpha=0;this.rockerArea.anchorX=this.rockerArea.anchorY=.5}static get ins(){if(!this._ins)new RockerManager;return this._ins}init(rocker,rockerBg,rockerRadis=0,rockerArea=[0],isFollow=false){this.isFollow=isFollow;if(rocker instanceof Laya.Image){this.rocker=rocker}else{this.rocker=new Laya.Image(rocker);scene.LayerManager.ins.addChild(this.rocker,scene.LayerName.ui_window)}this.rocker.anchorX=this.rocker.anchorY=.5;this.rocker.mouseEnabled=false;if(rockerBg instanceof Laya.Image){this.rockerBg=rockerBg}else{this.rockerBg=new Laya.Image(rockerBg);scene.LayerManager.ins.addChild(this.rockerBg,scene.LayerName.ui_window)}this.rockerBg.anchorX=this.rockerBg.anchorY=.5;this.rockerBg.mouseEnabled=false;this.rockerParent=this.rocker.parent;this.rockerParent.addChildAt(this.rockerArea,this.rockerParent.getChildIndex(this.rockerBg));this.initPoint.setTo(this.rockerBg.x,this.rockerBg.y);this.rocker.x=this.rockerArea.x=this.rockerBg.x;this.rocker.y=this.rockerArea.y=this.rockerBg.y;this.radis=rockerRadis==0?this.rockerBg.width>>1:rockerRadis;var hitArea=new Laya.HitArea;var graphics=new Laya.Graphics;if(!rockerArea||rockerArea.length==1){let areaRadis=rockerArea&&rockerArea[0]==0?this.rockerBg.width>>1:rockerArea[0];graphics.drawCircle(0,0,areaRadis,"#ffffff")}else{let areaX=rockerArea[0]==0?game.Define.DeviceW:rockerArea[0];let areaY=rockerArea[1]==0?game.Define.DeviceH:rockerArea[1];graphics.drawRect(rockerArea[0]==0?-this.rockerArea.x:-areaX>>1,rockerArea[1]==0?-this.rockerArea.y:-areaY>>1,areaX,areaY,"#ffffff")}hitArea.hit=graphics;this.rockerArea.hitArea=hitArea;this.rockerArea.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown)}get isTouch(){return this._isTouch}get isMove(){if(this.isTouch&&Laya.timer.currTimer-this.lastTime<80){return true}return false}onMouseDown(evt){evt.stopPropagation();if(!this.isCanTouch){return}let localMousePoint=new Laya.Point(Laya.stage.mouseX,Laya.stage.mouseY);this.rockerParent.globalToLocal(localMousePoint);this.rockerArea.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);this.rockerArea.on(Laya.Event.MOUSE_UP,this,this.onMouseUp);this.rockerArea.on(Laya.Event.ROLL_OUT,this,this.onMouseUp);this.moveCount=0;this._isTouch=true;if(this.isFollow){this.rocker.x=this.rockerBg.x=localMousePoint.x;this.rocker.y=this.rockerBg.y=localMousePoint.y}this.startPoint.setTo(localMousePoint.x,localMousePoint.y);this.lastPoint.setTo(localMousePoint.x,localMousePoint.y)}onMouseMove(t){if(this._isTouch){this.lastTime=Laya.timer.currTimer;this.curPoint.x=Laya.stage.mouseX;this.curPoint.y=Laya.stage.mouseY;let distance=this.lastPoint.distance(this.curPoint.x,this.curPoint.y);if((this.maxMoveCount==0||this.moveCount<this.maxMoveCount)&&distance>=this.mouseSpeed){let radian=Math.atan2(this.curPoint.y-this.startPoint.y,this.curPoint.x-this.startPoint.x);let angle=MathUtil.radianToAngle(radian);angle=MathUtil.changeAngle360(angle);this.rocker.x=this.rockerBg.x+Math.cos(radian)*this.radis;this.rocker.y=this.rockerBg.y+Math.sin(radian)*this.radis;EventManager.ins.event(NoticeEvent.ROCKER_DIRECTOR,{angle:angle.toFixed(2),radian:radian.toFixed(2)});this.lastPoint.setTo(this.curPoint.x,this.curPoint.y);this.moveCount++}}}onMouseUp(t){this.rockerArea.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);this.rockerArea.off(Laya.Event.MOUSE_UP,this,this.onMouseUp);this.rockerArea.off(Laya.Event.ROLL_OUT,this,this.onMouseUp);this._isTouch=false;this.rocker.x=this.rockerBg.x=this.initPoint.x;this.rocker.y=this.rockerBg.y=this.initPoint.y}}scene.RockerManager=RockerManager})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){class LayerManager{constructor(){if(LayerManager._ins!=null)throw new Error("LayerManager is single!")}static get ins(){if(!this._ins)LayerManager._ins=new LayerManager;return this._ins}init(){game.Global.root_bottom=Laya.stage.addChild(new Laya.Sprite);game.Global.root=Laya.stage.addChild(new Laya.Sprite);game.Global.root_top=Laya.stage.addChild(new Laya.Sprite);this.dicLayer=new Dictionary;this.dicLayer.add(LayerName.root,game.Global.root);this.dicLayer.add(LayerName.scene,game.Global.root.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.main,game.Global.root.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.ui,game.Global.root.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.top,game.Global.root.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.scene_map,this.dicLayer.get(LayerName.scene).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.scene_king,this.dicLayer.get(LayerName.scene).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.scene_effect,this.dicLayer.get(LayerName.scene).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.ui_window,this.dicLayer.get(LayerName.ui).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.ui_effect,this.dicLayer.get(LayerName.ui).addChild(new Laya.Sprite));EffectManager.ins.init()}setScale(scale=1){scene.SceneManager.ins.fillScale=scale;return}setScaleY(rate=0){if(rate!=1){this.getLayer(LayerName.scene).scaleY*=rate;this.getLayer(LayerName.main).scaleY*=rate;this.getLayer(LayerName.ui).scaleY*=rate;this.getLayer(LayerName.top).scaleY*=rate}else{this.getLayer(LayerName.scene).scaleY=1;this.getLayer(LayerName.main).scaleY=1;this.getLayer(LayerName.ui).scaleY=1;this.getLayer(LayerName.top).scaleY=1}}addChild(child,layerNum=LayerName.root){if(layerNum==LayerName.root){return game.Global.root.addChild(child)}else{return this.dicLayer.get(layerNum).addChild(child)}}removeChild(child,layerNum=LayerName.root){if(layerNum==LayerName.root){return game.Global.root.removeChild(child)}else{return this.dicLayer.get(layerNum).removeChild(child)}}removeLayerAllChild(layerNum){if(layerNum==LayerName.root){game.Global.root.removeChildren(4)}else{this.dicLayer.get(layerNum).removeChildren()}}getLayer(layerNum=LayerName.root){if(layerNum==LayerName.root){return game.Global.root}else{return this.dicLayer.get(layerNum)}}createBodyDiv(){}}scene.LayerManager=LayerManager;let LayerName;(function(LayerName){LayerName[LayerName["root"]=0]="root";LayerName[LayerName["scene"]=1]="scene";LayerName[LayerName["scene_map"]=2]="scene_map";LayerName[LayerName["scene_king"]=3]="scene_king";LayerName[LayerName["scene_effect"]=4]="scene_effect";LayerName[LayerName["main"]=5]="main";LayerName[LayerName["ui"]=6]="ui";LayerName[LayerName["ui_window"]=7]="ui_window";LayerName[LayerName["ui_effect"]=8]="ui_effect";LayerName[LayerName["top"]=9]="top"})(LayerName=scene.LayerName||(scene.LayerName={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var king;(function(king){class NpcManager{constructor(){this.npcCreateIndex=0;if(NpcManager._ins!=null)throw new Error("NpcManager is single!");this._dicNpc=new Dictionary;this._dicPool=new Dictionary}static get ins(){if(!this._ins)NpcManager._ins=new NpcManager;return this._ins}init(){}get npcs(){return this._dicNpc.valueOf()}createNpc(cls){let npc=null;let clsName=cls.name;let arrNpc=this._dicPool.get(clsName);if(!arrNpc){arrNpc=[];this._dicPool.add(clsName,arrNpc)}if(arrNpc.length>0){npc=arrNpc.pop();npc.reset()}else{npc=new cls;this.npcCreateIndex++;npc.objId=this.npcCreateIndex;npc.name="npc_"+npc.objId;npc.clsName=clsName}return npc}addNpc(npc){if(npc instanceof king.Npc){this._dicNpc.add(npc.objId,npc)}scene.LayerManager.ins.addChild(npc,scene.LayerName.scene_king);return npc}removeNpc(npcID){let npc=this._dicNpc.get(npcID);if(npc){this._dicNpc.remove(npc.objId);let arrNpc=this._dicPool.get(npc.clsName);if(arrNpc){arrNpc.push(npc)}else{}npc.removeSelf()}}}king.NpcManager=NpcManager})(king=scene.king||(scene.king={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var king;(function(king_1){class KingManager{constructor(){this.kingCreateIndex=0;if(KingManager._ins!=null)throw new Error("KingManager is single!");this._dicKing=new Dictionary;this._dicPool=new Dictionary}static get ins(){if(!this._ins)KingManager._ins=new KingManager;return this._ins}init(){}initData(actions){this.dicAction=new Dictionary;this.dicActionSkin=new Dictionary;for(let cfg of actions){this.dicAction.add(cfg.skin+"_"+cfg.actionType+"_"+cfg.actionDirect,cfg);if(this.dicActionSkin.hasKey(cfg.skin)){this.dicActionSkin.get(cfg.skin).push(cfg)}else{let arr=[];arr.push(cfg);this.dicActionSkin.add(cfg.skin,arr)}}console.log("Cfg_Action 初始化完成")}getCfg(skin,actionType,actionDirect){return this.dicAction.get(skin+"_"+actionType+"_"+actionDirect)}getCfgBySkin(skin){if(!this.dicActionSkin.hasKey(skin)){console.warn("请检查动作配置表："+skin+"是否配置！")}return this.dicActionSkin.get(skin)}getActionBySkin(skin){let arrAction=[];let arrCfg=this.getCfgBySkin(skin);for(let cfg of arrCfg){arrAction.push(new king_1.Action(cfg,cfg.actionType==king_1.ActionType.Wait||cfg.actionType==king_1.ActionType.WALK||cfg.actionType==king_1.ActionType.RUN))}return arrAction}get kings(){return this._dicKing.valueOf()}createKing(cls){let king=null;let clsName=cls.name;let arrKing=this._dicPool.get(clsName);if(!arrKing){arrKing=[];this._dicPool.add(clsName,arrKing)}if(arrKing.length>0){king=arrKing.pop();king.reset()}else{king=new cls;this.kingCreateIndex++;king.objId=this.kingCreateIndex;king.name="king_"+king.objId;king.clsName=clsName}return king}addKing(king){if(king instanceof king_1.King){this._dicKing.add(king.objId,king)}scene.LayerManager.ins.addChild(king,scene.LayerName.scene_king);return king}removeKing(kingID){let king=this._dicKing.get(kingID);if(king){this._dicKing.remove(king.objId);let arrKing=this._dicPool.get(king.clsName);if(arrKing){arrKing.push(king)}else{}king.removeSelf()}}}king_1.KingManager=KingManager})(king=scene.king||(scene.king={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var king;(function(king){var Templet=Laya.Templet;class BoneManager{constructor(){this.boneIndex=1e4;if(BoneManager._ins!=null)throw new Error("BoneManager is single!")}static get ins(){if(!this._ins)BoneManager._ins=new BoneManager;return this._ins}init(){this.dicTemp=new Dictionary;this.dicBonePool=new Dictionary;this.dicBone=new Dictionary}createBone(base64Type){let temp=null;let boneName=base64Type.name;let cacheType=base64Type.paramNum;if(this.dicTemp.hasKey(boneName)){temp=this.dicTemp.get(boneName)}else{temp=new Templet;this.dicTemp.add(boneName,temp)}let bone=null;let objId=0;if(temp.isParserComplete){if(this.dicBonePool.hasKey(boneName)){let arrSk=this.dicBonePool.get(boneName);if(arrSk&&arrSk.length>0){bone=arrSk.shift();console.log("从缓存池取出："+boneName+" 取出后还剩："+arrSk.length)}}if(!bone){bone=new king.BaseBone(boneName,cacheType)}}else{bone=new king.BaseBone(base64Type.name,base64Type.paramNum);if(temp.hasListener(Laya.Event.COMPLETE)){return bone}if(Base64Manager.isUseBase64){Laya.loader.cacheRes(base64Type.id,Base64Manager.ins.base64ToUint8Array(base64Type.base64Json))}temp.on(Laya.Event.COMPLETE,this,this.parseComplete,[base64Type.name]);temp.on(Laya.Event.ERROR,this,this.onError,[base64Type.paramNum]);temp.loadAni(base64Type.id)}return bone}onError(err){console.log("error",err)}parseComplete(data){console.log("spine动画模板："+data+" 加载完成！");EventManager.ins.event(NoticeEvent.BONE_TEMP_LOAD_FINISH,data)}getTemp(boneName){if(this.dicTemp.hasKey(boneName)){return this.dicTemp.get(boneName)}return null}getBone(objId){if(this.dicBone.hasKey(objId)){return this.dicBone.get(objId)}return null}addBone(bone){BoneManager.ins.dicBone.add(bone.objId,bone)}removeBone(bone){if(!bone){return}if(this.dicBone.hasKey(bone.objId)){this.dicBone.remove(bone.objId)}let arrSk=null;if(this.dicBonePool.hasKey(bone.kingType)){arrSk=this.dicBonePool.get(bone.kingType)}else{arrSk=new Array;this.dicBonePool.add(bone.kingType,arrSk)}if(arrSk){arrSk.push(bone)}}removeBoneAll(){for(let bone of this.dicBone.valueOf()){this.removeBone(bone)}}}king.BoneManager=BoneManager})(king=scene.king||(scene.king={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var net;(function(net){class NetManager{constructor(){if(NetManager._ins!=null)throw new Error("NetManager is single!");NetManager._ins=this;this._socketDataEvent=new Dictionary}static get ins(){if(!this._ins)new NetManager;return this._ins}init(){console.log("serverIP",game.Define.serverIP,"serverPort",game.Define.serverPort);this.socket=io.connect(game.Define.serverIP+":"+game.Define.serverPort);this.socket.on(SocketIoEvent.message,this.onMessageReveived);this.socket.on(SocketIoEvent.connect,this.onSocketOpen);this.socket.on(SocketIoEvent.disconnect,this.onSocketClose);this.socket.on(SocketIoEvent.error,this.onConnectError)}onSocketOpen(e=null){console.log("与服务器连接成功");EventManager.ins.event(SocketIoEvent.connect,e)}onSocketClose(e=null){console.log("与服务器连接断开");EventManager.ins.event(SocketIoEvent.disconnect,e)}onMessageReveived(message=null){console.log("收到服务端message");if(message){console.log(message)}else if(message){console.log(new Laya.Byte(message).readUTFBytes())}EventManager.ins.event(SocketIoEvent.message,message)}onConnectError(e=null){console.log("error");EventManager.ins.event(SocketIoEvent.error,e)}send(data,fn){if(!this.socket){console.error("NetManager 未初始化！");return}this.socket.send(data,fn)}emit(eventName,...args){if(!this.socket){console.error("NetManager 未初始化！");return}this.socket.emit(eventName,args)}registerNetEvent(eventName,_callback){if(this._socketDataEvent.hasKey(eventName)){this._socketDataEvent.get(eventName).push(_callback)}else{this._socketDataEvent.add(eventName,[_callback])}this.socket.on(eventName,_callback.method.bind(_callback.caller))}unregisterNetEvent(eventName,_callback){if(this._socketDataEvent.hasKey(eventName)){let arr=this._socketDataEvent.get(eventName);if(arr.indexOf(_callback)>=0){arr.splice(arr.indexOf(_callback))}}}update(){while(this._socketDataEvent.length>0){}}}net.NetManager=NetManager;class SocketIoEvent{}SocketIoEvent.connect="connect";SocketIoEvent.connect_error="connect_error";SocketIoEvent.connect_timeout="connect_timeout";SocketIoEvent.reconnect="reconnect";SocketIoEvent.disconnect="disconnect";SocketIoEvent.error="error";SocketIoEvent.message="message";net.SocketIoEvent=SocketIoEvent})(net=game.net||(game.net={}))})(game||(game={}));var game;(function(game){var net;(function(net){class HttpManager{constructor(){if(HttpManager._ins!=null)throw new Error("HttpManager is single!");this.xhr=new Laya.HttpRequest;this.xhr.http.timeout=5e4;this.xhr.on(Laya.Event.PROGRESS,this,this.onHttpRequestProgress)}static get ins(){if(!this._ins)HttpManager._ins=new HttpManager;return this._ins}link(url){console.log("link-url:",url);switch(game.Global.platformId){case PlatformID.Wx:case PlatformID.None:Laya.Browser.window.location.href=url;break;case PlatformID.Al:if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{TipManager.ins.showWord("Applovin does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.Is:if(PlatformManager.mraid){console.log("调用 mraid.openStoreUrl");PlatformManager.ins.actionCallBack(PlatformAction.DownLoad);PlatformManager.mraid.openStoreUrl(url)}else{TipManager.ins.showWord("IronSource does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.Ut:if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{TipManager.ins.showWord("Unity does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.Gg:if(Laya.Browser.window.ExitApi){Laya.Browser.window.ExitApi.exit()}if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{Laya.Browser.window.location.href=url}break;case PlatformID.Fb:if(PlatformManager.mraid){console.log("调用 mraid.open");Laya.Browser.window.FbPlayableAd.onCTAClick()}else{TipManager.ins.showWord("facebook does not support FbPlayableAd!");Laya.Browser.window.location.href=url}break;case PlatformID.Vg:if(parent){console.log("调用 parent.postMessage('download','*')");parent.postMessage("download","*")}else{TipManager.ins.showWord("vungle does not support parent.postMessage!");Laya.Browser.window.location.href=url}break;case PlatformID.Ac:if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{TipManager.ins.showWord("adcolony does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.Tj:if(PlatformManager.mraid){console.log("调用 mraid.click");PlatformManager.mraid.click()}else{TipManager.ins.showWord("tapjoy does not support window.TJ_API!");Laya.Browser.window.location.href=url}break;case PlatformID.mtg:PlatformManager.ins.actionCallBack(PlatformAction.GameEnd);PlatformManager.ins.actionCallBack(PlatformAction.DownLoad);break;case PlatformID.Tt:if(Laya.Browser.window.openAppStore){console.log("调用 window.openAppStore");Laya.Browser.window.openAppStore()}else{TipManager.ins.showWord("tiktok does not support window.openAppStore!");Laya.Browser.window.location.href=url}break;case PlatformID.Qq:if(Laya.Browser.window._gdtUnSdk){console.log("调用 window._gdtUnSdk");Laya.Browser.window._gdtUnSdk.playAble.onClick()}else{TipManager.ins.showWord("qq does not support window._gdtUnSdk!");Laya.Browser.window.location.href=url}break;case PlatformID.Bd:if(Laya.Browser.window.playableSDK){console.log("调用 window.playableSDK.openAppStore()");Laya.Browser.window.playableSDK.openAppStore()}else{TipManager.ins.showWord("ByteDance does not support window.playableSDK!");Laya.Browser.window.location.href=url}break;default:break}}get(url,caller,callback){this.caller=caller;this.callback=callback;this.xhr.once(Laya.Event.COMPLETE,this,this.onHttpRequestComplete);this.xhr.once(Laya.Event.ERROR,this,this.onHttpRequestError);this.xhr.send(url,null,"get","text");return this}post(url,data,contentType,caller,callback){this.caller=caller;this.callback=callback;this.xhr.once(Laya.Event.COMPLETE,this,this.onHttpRequestComplete);this.xhr.once(Laya.Event.ERROR,this,this.onHttpRequestError);if(contentType==null){this.xhr.send(url,data,"post","text")}else{this.xhr.send(url,data,"post","text",["content-type",contentType])}return this}onHttpRequestProgress(e){console.log("onHttpRequestProgress"+e);EventManager.ins.event(NoticeEvent.HTTP_PROGRESS,e)}onHttpRequestError(e){console.log("onHttpRequestError");this.callback.apply(this.caller,[{state:500,msg:e}])}onHttpRequestComplete(e){this.callback.apply(this.caller,[{state:200,data:this.xhr.data}])}}net.HttpManager=HttpManager})(net=game.net||(game.net={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class FrameManager{constructor(){if(FrameManager._ins!=null)throw new Error("FrameManager is single!");this.dicFrame=new Dictionary;this.dicFrameSkin=new Dictionary}static get ins(){if(!this._ins)FrameManager._ins=new FrameManager;return this._ins}init(frames){for(let cfg of frames){this.dicFrame.add(cfg.id,cfg);this.dicFrameSkin.add(cfg.skin,cfg)}console.log("Cfg_Frame 初始化完成")}getCfgs(){return this.dicFrame.valueOf()}getCfg(id){return this.dicFrame.get(id)}getCfgBySkin(skin){return this.dicFrameSkin.get(skin)}getFrame(id,callBack=null){let cfg=this.getCfg(id);if(cfg){return new effect.BaseFrame(cfg,callBack)}return null}getFrameBySkin(skin,callBack=null){let cfg=this.getCfgBySkin(skin);if(cfg){return new effect.BaseFrame(cfg,callBack)}return null}addFrame(frame,layer=LayerName.main){LayerManager.ins.addChild(frame,layer);return frame}removeFrame(frame){frame.removeSelf()}regAnimation(skinName){let cfg=this.getCfgBySkin(skinName);if(!cfg){console.log("FrameManager.ts 注册动画失败,请检查Frame表："+skinName);return}let arr=BaseAnimation.aniUrls(cfg.skin,cfg.count);Laya.Animation.createFrames(arr,skinName)}}effect.FrameManager=FrameManager})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class EffectManager{constructor(){if(EffectManager._ins!=null)throw new Error("EffectManager is single!")}static get ins(){if(!this._ins)EffectManager._ins=new EffectManager;return this._ins}init(){this.topWindow=LayerManager.ins.addChild(new Laya.Sprite,LayerName.ui_effect);this.topScene=LayerManager.ins.addChild(new Laya.Sprite,LayerName.scene_effect)}getEffect(en,effectData,isScene=true){let be=null;switch(en){case EffectName.boss_warning:be=new effect.BossWarningEft(isScene);break;case EffectName.guide_click:be=new effect.GuideClickEft(isScene);break;case EffectName.Fountain:be=new effect.FountainEft(isScene);break;case EffectName.change_img:be=new effect.ChangeImageEft(isScene);break;case EffectName.out_gold:be=new effect.OutGoldEft(isScene);break;case EffectName.air_drop:be=new effect.AirDropEft(isScene);break;case EffectName.waiting:be=new effect.WaitingEft(isScene);break;case EffectName.out_star:be=new effect.OutStarEft(isScene);break;default:console.error("EffectName not exist!");break}if(be)be.setData(effectData);return be}addEffect(be,layer=LayerName.main){LayerManager.ins.addChild(be,layer)}}effect.EffectManager=EffectManager;let EffectName;(function(EffectName){EffectName[EffectName["boss_warning"]=0]="boss_warning";EffectName[EffectName["guide_click"]=1]="guide_click";EffectName[EffectName["Fountain"]=2]="Fountain";EffectName[EffectName["change_img"]=3]="change_img";EffectName[EffectName["out_gold"]=4]="out_gold";EffectName[EffectName["air_drop"]=5]="air_drop";EffectName[EffectName["waiting"]=6]="waiting";EffectName[EffectName["out_star"]=7]="out_star"})(EffectName=effect.EffectName||(effect.EffectName={}))})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var config;(function(config){class Cfg_Skill{constructor(){this.atk=0;this.atkDistance=100;this.atkCD=0;this.atkX=0;this.atkY=0;this.atkingEft=0;this.atkingX=0;this.atkingY=0;this.atkingSpeed=100;this.atkingCount=1;this.atkingRotation=0}}config.Cfg_Skill=Cfg_Skill;class Cfg_Action{constructor(){}}config.Cfg_Action=Cfg_Action;class Cfg_Frame{constructor(){}}config.Cfg_Frame=Cfg_Frame;class Cfg_Item{constructor(){}}config.Cfg_Item=Cfg_Item;class Cfg_Level{constructor(){}}config.Cfg_Level=Cfg_Level;class Cfg_Monster{constructor(){}}config.Cfg_Monster=Cfg_Monster;class Cfg_Npc{constructor(){}}config.Cfg_Npc=Cfg_Npc})(config=game.config||(game.config={}))})(game||(game={}));var game;(function(game){var common;(function(common){class TweenManager{constructor(){if(TweenManager._ins!=null)throw new Error("TweenManager is single!");this.dicTween=new Dictionary}static get ins(){if(!this._ins)TweenManager._ins=new TweenManager;return this._ins}regTween(tt,isReplace=true){if(!tt){return}if(this.dicTween.hasKey(tt.id)){let ttNow=this.dicTween.get(tt.id);ttNow=tt}else{this.dicTween.add(tt.id,tt)}}play(loop,name){let tt=this.dicTween.get(name);if(tt){tt.play(loop)}}stop(name,isHide=true){let tt=this.dicTween.get(name);if(tt){tt.stop(isHide)}}clearAll(){for(let tt of this.dicTween.valueOf()){if(tt){tt.stop();Laya.timer.clearAll(tt)}}}creatProp(tpt,param=null){let ret=[];switch(tpt){case TweenPropType.PING_PANG:PubUtil.setNumber(param,0,30);PubUtil.setNumber(param,1,200);ret=[new TweenProp(param[1],0,0,-1,param[0]),new TweenProp(param[1]*.75,0,0,-1,-param[0]),new TweenProp(param[1]*.75,0,0,-1,param[0]),new TweenProp(param[1]*.5,0,0,-1,-(param[0]>>1)),new TweenProp(param[1]*.5,0,0,-1,param[0]>>2),new TweenProp(param[1]*.4,0,0,-1,0)];break;case TweenPropType.PING_PANG_1:PubUtil.setNumber(param,0,100);PubUtil.setNumber(param,1,200);ret=[new TweenProp(param[1],0,0),new TweenProp(param[1]*.75,0,-param[0]),new TweenProp(param[1]*.75,0,param[0]),new TweenProp(param[1]*.5,0,-(param[0]>>1)),new TweenProp(param[1]*.5,0,param[0]>>2),new TweenProp(param[1]*.4,0,0)];break;case TweenPropType.PING_PANG_2:PubUtil.setNumber(param,0,100);PubUtil.setNumber(param,1,200);ret=[new TweenProp(param[1],0,0),new TweenProp(param[1]*.75,0,-param[0]),new TweenProp(param[1]*.75,0,param[0]),new TweenProp(param[1]*.5,0,param[0]>>1),new TweenProp(param[1]*.5,0,param[0]>>2),new TweenProp(param[1]*.4,0,0)];break;case TweenPropType.PING_PANG_3:PubUtil.setNumber(param,0,100);PubUtil.setNumber(param,1,200);ret=[new TweenProp(param[1],0,0),new TweenProp(param[1],0,-param[0]),new TweenProp(param[1],0,0),new TweenProp(param[1],0,param[0]),new TweenProp(param[1],0,0)];break;case TweenPropType.GUIDE_SLID:PubUtil.setNumber(param,0,500);PubUtil.setNumber(param,1,100);PubUtil.setNumber(param,2,100);ret=[new TweenProp(param[0],0,0,1),new TweenProp(0,param[1],param[2],1),new TweenProp(0,0,0,0)];break;case TweenPropType.GUIDE_SLID_1:PubUtil.setNumber(param,0,500);PubUtil.setNumber(param,1,100);ret=[new TweenProp(param[0],0,0,1),new TweenProp(0,param[1],0,1),new TweenProp(0,0,0,0)];break;case TweenPropType.GUIDE_SLID_2:PubUtil.setNumber(param,0,500);PubUtil.setNumber(param,1,100);ret=[new TweenProp(param[0],0,0,1),new TweenProp(0,0,param[1],1),new TweenProp(0,0,0,0)];break;case TweenPropType.GUIDE_CLICK:PubUtil.setNumber(param,0,20);ret=[new TweenProp(100,0,param[0]),new TweenProp(100,0,param[0]>>1),new TweenProp(100,0,param[0]),new TweenProp(100,0,param[0]),new TweenProp(80,0,0)];break;case TweenPropType.LIGHT_STAR:PubUtil.setNumber(param,0,100);PubUtil.setNumber(param,1,0);PubUtil.setNumber(param,2,1);ret=[new TweenProp(param[0],0,0,param[2]),new TweenProp(param[0],0,0,param[1]),new TweenProp(param[0],0,0,param[2])];break;case TweenPropType.SMALL_BIG:PubUtil.setNumber(param,0,1);PubUtil.setNumber(param,1,1.2);PubUtil.setNumber(param,2,1e3);PubUtil.setNumber(param,3,1e3);ret=[new TweenProp(param[3],0,0,1,0,param[0],param[0]),new TweenProp(param[2],0,0,1,0,param[1],param[1]),new TweenProp(param[3],0,0,1,0,param[0],param[0])];break;default:break}return ret}resetTarget(name,target){let tt=this.dicTween.get(name);if(tt){tt.stop();tt.resetTarget(target);tt.play(tt.isLoop)}}resetTargetPos(name,x,y,isPlay=true){let tt=this.dicTween.get(name);if(tt){tt.stop();tt.target.x=x;tt.target.y=y;tt.resetTarget(tt.target);if(isPlay){tt.play(tt.isLoop)}}}resetProp(name,arrProp=null,delayTime=-1){let tt=this.dicTween.get(name);if(tt){tt.resetProp(arrProp,delayTime)}}resetPropByType(name,tpt,param=null,delayTime=-1){let tt=this.dicTween.get(name);if(tt){let arrProp=this.creatProp(tpt,param);tt.resetProp(arrProp,delayTime)}}}common.TweenManager=TweenManager;class TweenTarget{constructor(id,target,arrProp,delayTime,callBack=null){this.id="";this.delayTime=0;this.callBack=null;this.isLoop=true;this.propIndex=0;this.isPlay=true;this.curProp=null;this.targetX=0;this.targetY=0;this.id=id;this.resetTarget(target);this.arrProp=arrProp;this.delayTime=delayTime;this.callBack=callBack;this.curProp=new TweenProp(0)}play(isLoop=true){this.target.visible=true;Laya.Tween.clearAll(this.target);this.isLoop=isLoop;this.isPlay=true;this.propIndex=0;this.playNext()}playNext(){if(!this.isPlay){return}let propFrom=this.arrProp[this.propIndex++];let propTo=null;if(this.propIndex<this.arrProp.length){propTo=this.arrProp[this.propIndex];this.curProp.x=this.targetX+propTo.x;this.curProp.y=this.targetY+propTo.y;this.curProp.alpha=propTo.alpha==-1?this.target.alpha:propTo.alpha;this.curProp.rotation=propTo.rotation;this.curProp.scaleX=propTo.scaleX==-1?this.target.scaleX:propTo.scaleX;this.curProp.scaleY=propTo.scaleY==-1?this.target.scaleY:propTo.scaleY}else{if(this.isLoop){Laya.timer.once(this.delayTime,this,()=>{this.propIndex=0;this.playNext()})}else{}if(this.callBack)this.callBack();return}this.target.x=this.targetX+propFrom.x;this.target.y=this.targetY+propFrom.y;this.target.alpha=propFrom.alpha==-1?this.target.alpha:propFrom.alpha;this.target.rotation=propFrom.rotation;this.target.scaleX=propFrom.scaleX==-1?this.target.scaleX:propFrom.scaleX;this.target.scaleY=propFrom.scaleY==-1?this.target.scaleY:propFrom.scaleY;Laya.Tween.to(this.target,this.curProp,propFrom.duration,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.playNext()}))}stop(isHide=true){if(isHide){this.target.visible=false}this.isPlay=false;Laya.Tween.clearAll(this.target);Laya.timer.clearAll(this)}resetTarget(target){this.target=target;if(target){this.targetX=target.x;this.targetY=target.y}}resetProp(arrProp,delayTime=-1){if(arrProp){this.arrProp=arrProp}if(delayTime>=0){this.delayTime=delayTime}}}common.TweenTarget=TweenTarget;class TweenProp{constructor(duration,x=-1,y=-1,alpha=-1,rotation=0,scaleX=-1,scaleY=-1){this.duration=duration;this.x=x;this.y=y;this.alpha=alpha;this.rotation=rotation;this.scaleX=scaleX;this.scaleY=scaleY}}common.TweenProp=TweenProp;let TweenPropType;(function(TweenPropType){TweenPropType[TweenPropType["PING_PANG"]=0]="PING_PANG";TweenPropType[TweenPropType["PING_PANG_1"]=1]="PING_PANG_1";TweenPropType[TweenPropType["PING_PANG_2"]=2]="PING_PANG_2";TweenPropType[TweenPropType["PING_PANG_3"]=3]="PING_PANG_3";TweenPropType[TweenPropType["GUIDE_SLID"]=4]="GUIDE_SLID";TweenPropType[TweenPropType["GUIDE_SLID_1"]=5]="GUIDE_SLID_1";TweenPropType[TweenPropType["GUIDE_SLID_2"]=6]="GUIDE_SLID_2";TweenPropType[TweenPropType["GUIDE_CLICK"]=7]="GUIDE_CLICK";TweenPropType[TweenPropType["LIGHT_STAR"]=8]="LIGHT_STAR";TweenPropType[TweenPropType["SMALL_BIG"]=9]="SMALL_BIG"})(TweenPropType=common.TweenPropType||(common.TweenPropType={}))})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class TipManager{constructor(){if(TipManager._ins!=null)throw new Error("TipManager is single!")}static get ins(){if(!this._ins)TipManager._ins=new TipManager;return this._ins}showImg(url,x=0,y=0,offH=-50,style=0){let imgEfct;if(url instanceof Laya.Image){imgEfct=url}else{imgEfct=new Laya.Image(url)}imgEfct.x=x==0?game.Define.DeviceW>>1:x;imgEfct.y=y==0?game.Define.DeviceH>>1:y;imgEfct.anchorX=imgEfct.anchorY=.5;if(!imgEfct.parent){LayerManager.ins.addChild(imgEfct,LayerName.top)}switch(style){case 0:Laya.Tween.to(imgEfct,{y:imgEfct.y+offH},500,null,Laya.Handler.create(this,()=>{imgEfct.removeSelf();imgEfct=null}));break;case 1:Laya.Tween.to(imgEfct,{y:imgEfct.y+(offH>>1),scaleX:1.2,scaleY:1.2},200,null,Laya.Handler.create(this,()=>{Laya.Tween.to(imgEfct,{y:imgEfct.y+offH,scaleX:.5,scaleY:.5,alpha:0},200,null,Laya.Handler.create(this,()=>{imgEfct.removeSelf();imgEfct.destroy();imgEfct=null}),300)}));break;default:break}}showWord(msg,x=0,y=0,offH=-50,fontSize=40,fontColor="#000000",stroke=0,strokeColor="",style=0){let lbl=new Laya.Label;lbl.anchorX=.5;lbl.anchorY=.5;lbl.color=fontColor;lbl.fontSize=fontSize;lbl.align="center";if(stroke>0){lbl.stroke=stroke;lbl.strokeColor=strokeColor}lbl.text=msg;lbl.x=x==0?game.Define.DeviceW>>1:x;lbl.y=y==0?game.Define.DeviceH>>1:y;if(game.Define.screenMode==0){lbl.y=lbl.y/(SceneManager.ins.fillRate*SceneManager.ins.fillScale)}LayerManager.ins.addChild(lbl,LayerName.top);switch(style){case 0:Laya.Tween.to(lbl,{y:lbl.y+offH},700,null,Laya.Handler.create(this,()=>{lbl.removeSelf();lbl=null}));break;case 1:Laya.Tween.to(lbl,{y:lbl.y+(offH>>1),scaleX:2,scaleY:2},200,null,Laya.Handler.create(this,()=>{Laya.Tween.to(lbl,{y:lbl.y+offH,scaleX:.5,scaleY:.5,alpha:0},200,null,Laya.Handler.create(this,()=>{lbl.removeSelf();lbl=null}),500)}));break;default:break}}showNumber(num,x=0,y=0,offH=-50,style=0,path="game/img_number",numW=30,sp=null){sp=this.numberToImg(num,path,numW,sp);this.showImg(sp,x,y,offH,style)}numberToImg(num,path="game/img_number",numW=30,sp=null){var numL=num.toString().length;if(sp){while(sp.numChildren>0){sp.removeChildAt(0)}}else{sp=new Laya.Image}for(var i=0;i<numL;i++){var img=new Laya.Image;var nNmu=Math.pow(10,i);img.skin=path+Math.floor(num/nNmu%10)+".png";img.x=(numL-i-1)*numW;img.anchorY=.5;sp.addChild(img)}sp.width=i*numW;return sp}}common.TipManager=TipManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class SoundManager{constructor(){this.isOn=true;this.isShake=true;if(SoundManager._ins!=null)throw new Error("SoundManager is single!");Laya.SoundManager.muted=true;Laya.SoundManager.autoStopMusic=false;if(Laya.Browser.onIOS){Laya.SoundManager.useAudioMusic=false}if(PlatformManager.alPlatform!=null){this.setOn(false);console.log("Applovin默认静音")}}static get ins(){if(!this._ins)SoundManager._ins=new SoundManager;return this._ins}preload(arr,callBack,progress){Laya.loader.load(arr,callBack,progress)}init(callBack){}setOn(v){this.isOn=v;Laya.SoundManager.muted=!v}playMusic(bt){if(!bt){console.log("播放背景声音参数不能为空！");return}game.Define.SOUND_MAIN=bt;if(Base64Manager.isUseBase64){Laya.SoundManager.playMusic(bt.base64Img)}else{Laya.SoundManager.playMusic(bt.id)}}playSound(bt){if(!bt){console.log("播放声音参数不能为空！");return}if(this.isOn){if(Base64Manager.isUseBase64){Laya.SoundManager.playSound(bt.base64Img)}else{Laya.SoundManager.playSound(bt.id)}}}stopSound(soundName){Laya.SoundManager.stopSound(game.Define.CDN+soundName)}vibration(para){navigator.vibrate=navigator.vibrate||navigator["webkitVibrate"]||navigator["mozVibrate"]||navigator["msVibrate"];if(navigator.vibrate){console.log("支持设备震动！vibrate");navigator.vibrate(para)}else{console.log("不支持设备震动！")}}}common.SoundManager=SoundManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class ResManager{constructor(){if(ResManager._ins!=null)throw new Error("ResManager is single!")}static get ins(){if(!this._ins)ResManager._ins=new ResManager;return this._ins}preload(arrUrl,callBack,progress){Laya.loader.load(arrUrl,callBack,progress)}init(arrUrl,callBack,progress){Laya.loader.load(arrUrl,callBack,progress)}}common.ResManager=ResManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class OpenManager{constructor(){if(OpenManager._ins!=null)throw new Error("OpenManager is single!");OpenManager._ins=this;this.isDrawOpenView=false;this.wx=Laya.Browser.window.wx;this.init()}static get ins(){if(!this._ins)new OpenManager;return this._ins}init(){this.resizeStage()}postMsg(cmd,data){if(this.wx){var openDataContext=this.wx.getOpenDataContext();openDataContext.postMessage({cmd:cmd,data:data})}}resizeStage(){if(Laya.Browser.window.sharedCanvas){var scw=663;var sch=726;Laya.Browser.window.sharedCanvas.width=scw;Laya.Browser.window.sharedCanvas.height=sch;this.initOpenView()}}setLogin(){}setShareTicket(){}updateScore(){}showRankView(type){this.postMsg(common.NoticeEvent.ZY_RANK,null)}showOverView(){}showBeOverView(){}noticeUILoaded(data){}initOpenView(){if(Laya.Browser.window.sharedCanvas){this.openSp=new Laya.Sprite;this.openSp.on(Laya.Event.REMOVED,this,this.onRemoveOpenSp);this.openSp.pos(0,0)}}onRemoveOpenSp(){this.isDrawOpenView=false}changeOpenParent(parent,x,y){if(!Laya.Browser.window.sharedCanvas){return}this.isDrawOpenView=false;this.openSp.removeSelf();this.openSp.pos(x,y);if(parent){Laya.timer.once(1500,this,this.delayAddOpenSp,[parent])}}updateOpenView(){Laya.timer.once(2e3,this,this.drawOpenView)}delayAddOpenSp(parent){parent.addChild(this.openSp);this.isDrawOpenView=true;this.drawOpenView();this.updateOpenView()}drawOpenView(){if(this.isDrawOpenView){this.openSp.graphics.clear();if(this.openTex)this.openTex.destroy();this.openTex=new Laya.Texture(Laya.Browser.window.sharedCanvas);this.openSp.graphics.drawTexture(this.openTex,0,0,this.openTex.width,this.openTex.height)}}}common.OpenManager=OpenManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var base64;(function(base64_1){class Base64Manager{constructor(){this.loadIndex=0;if(Base64Manager._ins!=null)throw new Error("Base64Manager is single!");this.arrLoadAtlas=[]}static get ins(){if(!this._ins)Base64Manager._ins=new Base64Manager;return this._ins}init(){}loadAtlas(arrAtlas,callBack,progress){if(!arrAtlas||arrAtlas.length==0){if(callBack){callBack.run()}return}console.log("开始加载BASE64图集....共计："+arrAtlas.length);this.arrLoadAtlas=arrAtlas;this.callBack=callBack;this.progress=progress;this.loadIndex=0;this.parseAtlasNext()}parseAtlasNext(){if(this.progress&&this.progress.caller!=this){this.progress.runWith({data:this.loadIndex/this.arrLoadAtlas.length})}if(this.loadIndex>=this.arrLoadAtlas.length){if(this.callBack){this.callBack.run()}return}this.parseAtlas(this.arrLoadAtlas[this.loadIndex++])}parseAtlas(base64Type){if(base64Type.base64Img==null||base64Type.base64Img==""){this.cacheBase64Json(base64Type);return}if(base64Type.base64Json==null||base64Type.base64Json==""){this.cacheBase64Img(base64Type);return}let json=this.base64ToJson(base64Type.base64Json);let atlasName=json.meta.prefix;let img=new Laya.Image;img.skin=base64Type.base64Img}cacheBase64Img(base64Type){let img=new Laya.Image;img.skin=base64Type.base64Img}cacheBase64Json(base64Type){let json=this.base64ToJson(base64Type.base64Json);Laya.loader.cacheRes(base64Type.id,json);this.parseAtlasNext()}checkImg(img,base64Type){if(!img){console.error("参数为空");return}if(Base64Manager.isUseBase64){if(base64Type){img.skin=base64Type.base64Img}else{}}else{if(base64Type){img.skin=base64Type.id}else{}}}checkVideo(img,base64Type){if(!img){console.error("参数为空");return}if(Base64Manager.isUseBase64){if(base64Type){img.src=base64Type.base64Img}else{}}else{if(base64Type){img.src=base64Type.id}else{}}}base64ToJson(base64){let jsonStr=window.atob(base64);let json=JSON.parse(jsonStr);return json}base64ToUint8Array(base64String){const padding="=".repeat((4-base64String.length%4)%4);const base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/");const rawData=window.atob(base64);const outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i)}return outputArray}arrayBufferToBase64(buffer){var binary="";var bytes=new Uint8Array(buffer);var len=bytes.byteLength;for(var i=0;i<len;i++){binary+=String.fromCharCode(bytes[i])}return window.btoa(binary)}}Base64Manager.isUseBase64=false;base64_1.Base64Manager=Base64Manager;class Base64Type{constructor(id,name,base64Json="",base64Img="",paramStr="",paramNum=0){this.id=id;this.name=name;this.base64Json=base64Json;this.base64Img=base64Img;this.paramStr=paramStr;this.paramNum=paramNum}}base64_1.Base64Type=Base64Type})(base64=game.base64||(game.base64={}))})(game||(game={}));var game;(function(game){var common;(function(common){class EventManager extends Laya.EventDispatcher{constructor(){if(EventManager._ins!=null)throw new Error("EventManager is single!");super()}static get ins(){if(!this._ins)EventManager._ins=new EventManager;return this._ins}init(){}event(type,data){super.on;return super.event(type,new NoticeEvent(type,data))}}common.EventManager=EventManager;class NoticeEvent{constructor(type,data){this.type=type;this.data=data}}NoticeEvent.PLATFORM_INIT_OVER="PLATFORM_INIT_OVER";NoticeEvent.PLATFORM_LOGIN_SUCCESS="PLATFORM_LOGIN_SUCCESS";NoticeEvent.PLATFORM_LOGIN_FAIL="GAME_RES_LOAD_FINISH";NoticeEvent.GAME_RES_LOAD_FINISH="GAME_RES_LOAD_FINISH";NoticeEvent.HTTP_PROGRESS="HTTP_PROGRESS";NoticeEvent.TOUCH="TOUCH";NoticeEvent.TOUCH_DIRECTOR="TOUCH_DIRECTOR";NoticeEvent.ROCKER_DIRECTOR="ROCKER_DIRECTOR";NoticeEvent.BONE_TEMP_LOAD_FINISH="BONE_TEMP_LOAD_FINISH";NoticeEvent.SYS_FOCUS="SYS_FOCUS";NoticeEvent.SYS_BLUR="SYS_BLUR";NoticeEvent.SYS_SCREEN_VERTICAL="SYS_SCREEN_VERTICAL";NoticeEvent.SYS_SCREEN_HORIZONTAL="SYS_SCREEN_HORIZONTAL";NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE="SYS_SCREEN_VERTICAL_ONSIZE";NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE="SYS_SCREEN_HORIZONTAL_ONSIZE";NoticeEvent.GAME_SCORE_UPDATE="GAME_SCORE_UPDATE";NoticeEvent.GAME_GOLD_UPDATE="GAME_GOLD_UPDATE";NoticeEvent.GAME_LEVEL_UPDATE="GAME_LEVEL_UPDATE";NoticeEvent.GAME_OVER="GAME_OVER";NoticeEvent.GAME_AGIN="GAME_AGIN";NoticeEvent.GAME_NEXT="GAME_NEXT";NoticeEvent.GAME_WARNING="GAME_WARNING";NoticeEvent.EFT_AIR_DROP_OVER="EFT_AIR_DROP_OVER";NoticeEvent.AI_IMAGE_TO_WORD="AI_IMAGE_TO_WORD";NoticeEvent.ZY_RESIZE="ZY_RESIZE";NoticeEvent.ZY_LOGIN="ZY_LOGIN";NoticeEvent.ZY_RANK="ZY_RANK";NoticeEvent.ZY_SCORE="ZY_SCORE";common.NoticeEvent=NoticeEvent})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var display;(function(display){class BaseDisplay extends Laya.Sprite{constructor(){super();this._isDisplay=false;this._isInit=false;this.on(Laya.Event.ADDED,this,this.ADDED)}ADDED(event){if(!this._isInit){this._isInit=true;this.init()}this._isDisplay=true;this.off(Laya.Event.ADDED,this,this.ADDED);this.on(Laya.Event.REMOVED,this,this.REMOVED);this.onAdd()}REMOVED(event){this._isDisplay=false;this.on(Laya.Event.ADDED,this,this.ADDED);this.off(Laya.Event.REMOVED,this,this.REMOVED);this.onRemove()}onAdd(){}onRemove(){Laya.Tween.clearAll(this);Laya.timer.clearAll(this)}init(){}get isDisplay(){return this._isDisplay}}display.BaseDisplay=BaseDisplay})(display=game.display||(game.display={}))})(game||(game={}));var game;(function(game){var display;(function(display){class BaseAnimation extends display.BaseDisplay{constructor(){super();this.isLoad=false;this.anim=new Laya.Animation;this.addChild(this.anim)}onAdd(){this.anim.on(Laya.Event.LABEL,this,this.onLabel);this.anim.on(Laya.Event.STOPPED,this,this.onStop);this.anim.on(Laya.Event.COMPLETE,this,this.onComplete)}onRemove(){this.anim.off(Laya.Event.LABEL,this,this.onLabel);this.anim.off(Laya.Event.STOPPED,this,this.onStop);this.anim.off(Laya.Event.COMPLETE,this,this.onStop);Laya.timer.clearAll(this.anim);Laya.timer.clearAll(this)}setSkin(skinData,isAdd=true){}setInterval(count=50){this.anim.interval=count}play(){this.anim.play()}stop(){this.anim.stop()}onLabel(ev){}onStop(ev){}onComplete(ev){}static aniUrls(skinName,length){var urls=[];for(var i=1;i<=length;i++){urls.push(skinName+"_"+i+".png")}return urls}}display.BaseAnimation=BaseAnimation})(display=game.display||(game.display={}))})(game||(game={}));var game;(function(game){var display;(function(display){class BaseUI extends display.BaseDisplay{constructor(){super();this.dicInitPosition=new Dictionary}onAdd(){super.onAdd();this.open()}onRemove(){super.onRemove();this.close()}open(){}close(){}detory(){}isOpen(){return this!=null&&this.parent!=null}scaleH(){}scaleV(){}recordInitPosition(ui){if(ui instanceof Laya.View){this.recordViewPosition(ui)}else{this.dicInitPosition.add(ui.name,new Laya.Point(ui.x,ui.y))}}recordViewPosition(sp){for(let i=0;i<sp.numChildren;i++){let child=sp.getChildAt(i);if(child.name!=""){this.dicInitPosition.add(child.name,new Laya.Point(child.x,child.y))}if(child instanceof Laya.Sprite){this.recordViewPosition(child)}}}getInitPosition(name){var point=this.dicInitPosition.get(name);if(!point){point=new Laya.Point}return point}getInitPositionOffX(sp1,sp2){if(!sp1||!sp2){return 0}let p1=this.getInitPosition(sp1.name);let p2=this.getInitPosition(sp2.name);return p2.x-p1.x}getInitPositionOffY(sp1,sp2){if(!sp1||!sp2){return 0}let p1=this.getInitPosition(sp1.name);let p2=this.getInitPosition(sp2.name);return p2.y-p1.y}resetInitPosition(sp){var point=this.dicInitPosition.get(sp.name);if(point){sp.x=point.x;sp.y=point.y}}setPositionByOffX(sp1,sp2){if(!sp1||!sp2){return}let offX=this.getInitPositionOffX(sp1,sp2);sp2.x=sp1.x+offX}setPositionByOffY(sp1,sp2){if(!sp1||!sp2){return}let offY=this.getInitPositionOffY(sp1,sp2);sp2.y=sp1.y+offY}}display.BaseUI=BaseUI})(display=game.display||(game.display={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){var BaseUI=game.display.BaseUI;class BaseEffect extends BaseUI{constructor(isScene){super();this.isPlaying=false}init(){}open(){super.open()}close(){super.close();this.isPlaying=false;Laya.Tween.clearAll(this)}setData(effectData){this.effectData=effectData}play(parent=null){if(this.isPlaying){return}if(!this.parent){if(parent instanceof Laya.Sprite){parent.addChild(this)}else{effect.EffectManager.ins.addEffect(this,parent?parent:LayerName.ui_effect)}}this.isPlaying=true}stop(){this.removeSelf()}lineMove(line,from,to,time1,time2,delayTime=0){line.x=from;Laya.Tween.to(line,{x:to},time1,null,Laya.Handler.create(this,()=>{Laya.Tween.to(line,{x:from},time2,null,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(line)}))}),delayTime)}}effect.BaseEffect=BaseEffect;class BaseEffectData{constructor(){}}effect.BaseEffectData=BaseEffectData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class AirDropEft extends effect.BaseEffect{constructor(isScene){super(isScene)}init(){}setData(data){super.setData(data);this.data=data;if(this.data.shadowSkin){this.imgShadow=new Laya.Image(this.data.shadowSkin);this.imgShadow.anchorX=this.imgShadow.anchorY=.5;this.imgShadow.visible=false;this.addChild(this.imgShadow)}if(this.data.parachuteSkin){this.imgParachute=new Laya.Image(this.data.parachuteSkin);this.imgParachute.anchorX=this.imgParachute.anchorY=.5;this.imgParachute.visible=false;this.addChild(this.imgParachute)}if(this.data.planSkin){this.imgPlane=new Laya.Image(this.data.planSkin);this.imgPlane.anchorX=this.imgPlane.anchorY=.5;this.imgPlane.rotation=this.data.planeRotate;this.imgPlane.visible=false;this.addChild(this.imgPlane)}if(this.data.dropBoxSkin){this.imgDropBox=new Laya.Image(this.data.dropBoxSkin);this.imgDropBox.anchorX=this.imgDropBox.anchorY=.5;this.imgDropBox.visible=false;this.addChild(this.imgDropBox)}}close(){super.close();Laya.Tween.clearAll(this.imgPlane);Laya.Tween.clearAll(this.imgParachute);Laya.Tween.clearAll(this.imgShadow);Laya.Tween.clearAll(this.imgDropBox)}play(parent=null){super.play(parent);if(this.imgPlane){this.imgPlane.x=this.data.planeStartPoint.x;this.imgPlane.y=this.data.planeStartPoint.y;this.imgPlane.visible=true;Laya.Tween.to(this.imgPlane,{x:this.data.planeEndPoint.x,y:this.data.planeEndPoint.y},this.data.planeFlyTime,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.imgPlane.visible=false}))}if(this.imgDropBox){this.imgDropBox.visible=false}Laya.timer.once(this.data.parachuteDelayTime,this,()=>{this.imgParachute.x=this.data.parachuteStartPoint.x;this.imgParachute.y=this.data.parachuteStartPoint.y;this.imgParachute.scaleX=this.imgParachute.scaleY=this.data.parachuteStartScale;this.imgParachute.visible=true;Laya.Tween.to(this.imgParachute,{x:this.data.parachuteEndPoint.x,y:this.data.parachuteEndPoint.y,scaleX:this.data.parachuteEndScale,scaleY:this.data.parachuteEndScale},this.data.parachuteFlyTime,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.imgParachute.visible=false;EventManager.ins.event(NoticeEvent.EFT_AIR_DROP_OVER);if(this.imgDropBox){this.imgDropBox.x=this.data.parachuteEndPoint.x;this.imgDropBox.y=this.data.parachuteEndPoint.y;this.imgDropBox.visible=true}}));this.imgShadow.x=this.data.shadowStartPoint.x;this.imgShadow.y=this.data.shadowStartPoint.y;this.imgShadow.scaleX=this.imgShadow.scaleY=this.data.shadowStartScale;this.imgShadow.visible=true;Laya.Tween.to(this.imgShadow,{x:this.data.parachuteEndPoint.x,y:this.data.parachuteEndPoint.y,scaleX:this.data.shadowEndScale,scaleY:this.data.shadowEndScale},this.data.parachuteFlyTime,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.imgShadow.visible=false}))})}stop(){super.stop()}}effect.AirDropEft=AirDropEft;class AirDropData extends effect.BaseEffectData{constructor(planSkin,parachuteSkin,shadowSkin,dropBoxSkin){super();this.planeFlyTime=1e3;this.planeRotate=0;this.parachuteDelayTime=500;this.parachuteFlyTime=1e3;this.parachuteStartScale=1;this.parachuteEndScale=1;this.shadowStartScale=1;this.shadowEndScale=1;this.planSkin=planSkin;this.parachuteSkin=parachuteSkin;this.shadowSkin=shadowSkin;this.dropBoxSkin=dropBoxSkin;this.planeStartPoint=new Laya.Point(0,game.Define.DeviceH);this.planeEndPoint=new Laya.Point(game.Define.DeviceW,0);this.parachuteStartPoint=new Laya.Point(game.Define.DeviceW>>1,0);this.parachuteEndPoint=new Laya.Point(game.Define.DeviceW>>1,game.Define.DeviceH>>1);this.shadowStartPoint=new Laya.Point(game.Define.DeviceW>>1,game.Define.DeviceH)}}effect.AirDropData=AirDropData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){var BaseAnimation=game.display.BaseAnimation;class BaseFrame extends BaseAnimation{constructor(cfg,callBack=null){super();this.skin="";this.count=1;this.isLoop=false;this.isRemove=true;this.setData(cfg);this.callBack=callBack}setData(cfg){if(cfg){this.skin=cfg.skin;this.count=cfg.count;this.width=cfg.width;this.height=cfg.height;this.pivot(this.width>>1,this.height>>1);this.setInterval(cfg.rate)}else{console.log("序列帧数据为空！")}}init(){}onAdd(){super.onAdd();if(this.isLoad){this.playFrame(this.isLoop,null,this.isRemove)}else{this.loadFinish()}}loadFinish(){this.isLoad=true;let arr=BaseAnimation.aniUrls(this.skin,this.count);Laya.Animation.createFrames(arr,this.skin);this.playFrame(this.isLoop,null,this.isRemove)}setSkin(skin){if(this.anim){if(this.skin==skin){return}let cfg=effect.FrameManager.ins.getCfgBySkin(skin);this.setData(cfg);this.loadFinish();if(cfg==null){return}this.skin=skin;this.anim.play(0,this.isLoop,skin)}}playFrame(isLoop=false,parent=null,isRemove=true){this.isLoop=isLoop;this.isRemove=isRemove;if(this.isDisplay){if(this.anim.isPlaying){return}this.anim.play(0,this.isLoop,this.skin)}else{if(parent instanceof Laya.Sprite){parent.addChild(this)}else{effect.FrameManager.ins.addFrame(this,parent?parent:LayerName.ui_effect)}}}stopFrame(){super.stop();if(this.isRemove){this.removeSelf()}}onLabel(ev){}onStop(ev){super.onStop(ev)}onComplete(ev){super.onComplete(ev);if(!this.isLoop){this.stopFrame()}if(this.callBack){this.callBack.run()}}}effect.BaseFrame=BaseFrame})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class BossWarningEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.imgLine1=null;this.imgLine2=null;this.imgLine3=null;this.imgLine4=null;this.imgLine5=null;this.imgBoss=null;this.lblWord=null;this.imgLine1=new Laya.Image;this.addChild(this.imgLine1);this.imgLine2=new Laya.Image;this.addChild(this.imgLine2);this.imgLine3=new Laya.Image;this.addChild(this.imgLine3);this.imgLine4=new Laya.Image;this.addChild(this.imgLine4);this.imgLine5=new Laya.Image;this.addChild(this.imgLine5);this.imgBoss=new Laya.Image;this.imgBoss.anchorX=.5;this.addChild(this.imgBoss);this.lblWord=new Laya.Label;this.lblWord.anchorX=.5;this.lblWord.wordWrap=true;this.addChild(this.lblWord)}init(){}setData(effectData){super.setData(effectData);this.data=effectData;this.imgLine1.skin=this.data.line1Skin;this.imgLine2.skin=this.data.line2Skin;this.imgLine3.skin=this.data.line1Skin;this.imgLine4.skin=this.data.line2Skin;this.imgLine5.skin=this.data.line1Skin;this.imgLine1.y=-this.imgLine1.height-this.imgLine2.height-(this.imgLine3.height>>1);this.imgLine2.y=this.imgLine1.y+this.imgLine1.height+this.data.linePadding;this.imgLine3.y=this.imgLine2.y+this.imgLine2.height+this.data.linePadding;this.imgLine4.y=this.imgLine3.y+this.imgLine3.height+this.data.linePadding;this.imgLine5.y=this.imgLine4.y+this.imgLine4.height+this.data.linePadding;this.imgBoss.skin=this.data.bossSkin;this.imgBoss.y=this.data.bossY;this.lblWord.text=this.data.word;this.lblWord.y=this.data.wordY;this.lblWord.width=this.data.wordW>0?this.data.wordW:this.lblWord.displayWidth;this.lblWord.height=this.data.wordH>0?this.data.wordH:this.lblWord.displayHeight;this.lblWord.fontSize=this.data.wordSize;this.lblWord.color=this.data.wordColor;this.lblWord.stroke=this.data.wordStroke;this.lblWord.strokeColor=this.data.wordStrokeColor}open(){}close(){super.close();Laya.Tween.clearAll(this.imgLine1);Laya.Tween.clearAll(this.imgLine2);Laya.Tween.clearAll(this.imgLine3);Laya.Tween.clearAll(this.imgLine4);Laya.Tween.clearAll(this.imgLine5);Laya.Tween.clearAll(this.imgBoss)}play(parent=null){super.play(parent);let halfX=game.Define.DeviceW>>1;this.imgBoss.x=game.Define.DeviceH;Laya.Tween.to(this.imgBoss,{x:halfX},700,null,Laya.Handler.create(this,()=>{Laya.Tween.to(this.imgBoss,{x:-this.imgBoss.width},200,null,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(this.imgBoss);this.stop()}),800)}));if(this.lblWord.text!=""){this.lblWord.x=game.Define.DeviceH;Laya.Tween.to(this.lblWord,{x:halfX},700,null,Laya.Handler.create(this,()=>{Laya.Tween.to(this.lblWord,{x:-this.lblWord.width},200,null,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(this.lblWord)}),800)}))}let time1=600,time2=600;this.lineMove(this.imgLine1,game.Define.DeviceH,-this.imgLine1.width,time1,time2,100);this.lineMove(this.imgLine2,-this.imgLine2.width,game.Define.DeviceH,time1,time2,200);this.lineMove(this.imgLine3,game.Define.DeviceH,-this.imgLine3.width,time1,time2,300);this.lineMove(this.imgLine4,-this.imgLine4.width,game.Define.DeviceH,time1,time2,400);this.lineMove(this.imgLine5,game.Define.DeviceH,-this.imgLine5.width,time1,time2,500)}stop(){super.stop()}}effect.BossWarningEft=BossWarningEft;class BossWarningData extends effect.BaseEffectData{constructor(bossSkin,line1Skin,line2Skin,word){super();this.linePadding=20;this.bossY=0;this.wordY=0;this.wordW=0;this.wordH=0;this.wordSize=30;this.wordColor="#ffffff";this.wordStroke=0;this.wordStrokeColor="#ffffff";this.bossSkin=bossSkin;this.line1Skin=line1Skin;this.line2Skin=line2Skin;this.word=word}}effect.BossWarningData=BossWarningData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class ChangeImageEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.arrImg=null;this.imgCount=0;this.curIndex=0;this.curImg=null}init(){}setData(effectData){super.setData(effectData);this.data=effectData;let img=null;this.arrImg=[];for(let skin of this.data.arrString){img=new Laya.Image;img.anchorX=img.anchorY=.5;img.skin=skin;this.addChild(img);this.arrImg.push(img)}this.imgCount=this.data.arrString.length;this.x=game.Define.DeviceW>>1;this.y=game.Define.DeviceH>>1;if(this.data.changeTime<=0)this.data.changeTime=1e3}close(){super.close();Laya.Tween.clearAll(this.curImg)}play(parent=null){super.play(parent);if(!this.isPlaying){return}Laya.timer.loop(this.data.changeTime,this,()=>{this.curIndex++;if(this.curIndex>=this.imgCount){this.curIndex=0}let img;for(let i=0;i<this.imgCount;i++){img=this.arrImg[i];img.visible=i==this.curIndex;if(img.visible){this.curImg=img}}this.curImg.scaleX=this.curImg.scaleY=.2;Laya.Tween.to(this.curImg,{scaleX:1.2,scaleY:1.2},200,Laya.Ease.linearInOut,Laya.Handler.create(this,()=>{Laya.Tween.to(this.curImg,{scaleX:1,scaleY:1},100,Laya.Ease.linearInOut,Laya.Handler.create(this,()=>{}))}))})}stop(){super.stop()}}effect.ChangeImageEft=ChangeImageEft;class ChangeImageData extends effect.BaseEffectData{constructor(){super();this.changeTime=1e3}}effect.ChangeImageData=ChangeImageData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class FountainEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.arrImg=[]}init(){}setData(effectData){super.setData(effectData);this.data=effectData;if(this.data.imgSkin){this.arrString=[];this.arrString.push(this.data.imgSkin)}}open(){}close(){super.close();for(let img of this.arrImg){Laya.Tween.clearAll(img)}}play(parent=null){super.play(parent);Laya.timer.loop(this.data.oneSendTime,this,this.launch)}launch(){let randIndex=MathUtil.randomRange(0,this.arrString.length-1);let skin=this.arrString[randIndex];let img=this.getImg(skin);this.addChild(img);img.x=MathUtil.randomRange(0,this.data.minX>>2);img.x=MathUtil.randomRange(0,1)==0?img.x:-img.x;img.y=0;img.scaleX=img.scaleY=.8;img.alpha=.6;let randX=MathUtil.randomRange(this.data.minX,this.data.maxX);randX=MathUtil.randomRange(0,1)==0?randX:-randX;let randY=MathUtil.randomRange(this.data.minY,this.data.maxY);Laya.Tween.to(img,{y:randY,rotation:this.data.needRotation*.4,scaleX:1,scaleY:1,alpha:1},this.data.oneShowTime*.3,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{Laya.Tween.to(img,{x:randX>>1,y:randY+50,rotation:this.data.needRotation*.7},this.data.oneShowTime*.4,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{Laya.Tween.to(img,{x:randX,y:0,rotation:this.data.needRotation},this.data.oneShowTime*.3,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(img);img.removeSelf()}))}))}))}getImg(skin){let ret=null;for(let img of this.arrImg){if(img&&!img.parent){ret=img;break}}if(!ret){ret=new Laya.Image;ret.anchorX=ret.anchorY=.5;ret.skin=skin;this.arrImg.push(ret)}return ret}stop(){Laya.Tween.clearAll(this);Laya.timer.clearAll(this);super.stop()}}effect.FountainEft=FountainEft;class FountainData extends effect.BaseEffectData{constructor(imgSkin){super();this.oneSendTime=10;this.oneShowTime=200;this.minX=0;this.maxX=0;this.minY=0;this.maxY=0;this.needRotation=0;this.imgSkin=imgSkin;this.maxX=game.Define.DeviceW;this.maxY=game.Define.DeviceH}}effect.FountainData=FountainData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class GuideClickEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.imgWater=null;this.imgHand=null;this.imgWater=new Laya.Image;this.imgWater.anchorX=this.imgWater.anchorY=.5;this.addChild(this.imgWater);this.imgHand=new Laya.Image;this.addChild(this.imgHand)}init(){}setData(effectData){super.setData(effectData);this.data=effectData;this.imgWater.alpha=this.data.waterAlphaStart;this.imgWater.graphics.clear();this.imgWater.graphics.drawCircle(0,0,this.data.waterRadis,this.data.waterColor);this.imgHand.skin=this.data.handSkin;if(this.data.handCenter!=0){this.imgHand.anchorX=this.imgHand.anchorY=.5}}close(){super.close();Laya.Tween.clearAll(this.imgWater);Laya.Tween.clearAll(this.imgHand)}play(parent=null){super.play(parent);let halfX=game.Define.DeviceW>>1;this.big(this.imgWater,this.imgHand)}big(sp,hand){if(!this.isPlaying){return}Laya.Tween.to(hand,{scaleX:.5,scaleY:.5},350,null,Laya.Handler.create(this,()=>{Laya.Tween.clearTween(hand);Laya.Tween.to(hand,{scaleX:1,scaleY:1},350,null,Laya.Handler.create(this,()=>{Laya.Tween.clearTween(hand);this.big(sp,hand)}))}));Laya.timer.once(200,this,()=>{sp.scaleX=1;sp.scaleY=1;sp.alpha=this.data.waterAlphaStart;Laya.Tween.to(sp,{scaleX:this.data.waterRadisRate,scaleY:this.data.waterRadisRate,alpha:this.data.waterAlphaEnd},300,null,Laya.Handler.create(this,()=>{Laya.Tween.clearTween(sp)}))})}stop(){super.stop()}}effect.GuideClickEft=GuideClickEft;class GuideClickData extends effect.BaseEffectData{constructor(handSkin){super();this.handSkin="";this.handCenter=0;this.waterRadis=50;this.waterRadisRate=2;this.waterAlphaStart=1;this.waterAlphaEnd=0;this.waterColor="#ffffff";this.handSkin=handSkin}}effect.GuideClickData=GuideClickData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class OutGoldEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.arrGold=null;this.arrGold=[]}init(){}setData(effectData){super.setData(effectData);this.data=effectData;for(let i=0;i<this.data.count;i++){let img=new Laya.Image(this.data.imgSkin);this.arrGold.push(img);img.anchorX=img.anchorY=.5;this.addChild(img)}}close(){super.close();Laya.Tween.clearAll(this);Laya.Tween.clearAll(this)}play(parent=null){super.play(parent);let halfX=game.Define.DeviceW>>1;for(let i=0;i<this.data.count;i++){let img=this.arrGold[i];img.visible=true;img.scaleX=img.scaleY=MathUtil.randomRange(this.data.minScale,this.data.maxScale)/100;img.x=MathUtil.randomRange(this.data.minX,this.data.maxX);img.y=MathUtil.randomRange(this.data.minY,this.data.maxY);let toX=img.x+(Math.random()<.5?1:-1)*this.data.dropOffx;Laya.Tween.to(img,{x:toX,y:this.data.dropY},this.data.dropTime,Laya.Ease.backIn,Laya.Handler.create(this,()=>{img.visible=false},[img]),i*5)}}stop(){super.stop()}}effect.OutGoldEft=OutGoldEft;class OutGoldData extends effect.BaseEffectData{constructor(imgSkin,count){super();this.imgSkin="";this.count=0;this.minX=0;this.maxX=0;this.minY=0;this.maxY=0;this.dropOffx=0;this.dropY=0;this.dropTime=500;this.minScale=50;this.maxScale=100;this.imgSkin=imgSkin;this.count=count;this.maxX=game.Define.DeviceW;this.maxY=game.Define.DeviceH>>1;this.dropY=game.Define.DeviceH}}effect.OutGoldData=OutGoldData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class OutStarEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.arrStar=null;this.arrStar=[]}init(){}setData(effectData){super.setData(effectData);this.data=effectData;for(let i=0;i<this.data.count;i++){let img=new Laya.Image(this.data.imgSkin);this.arrStar.push(img);img.anchorX=img.anchorY=.5;this.addChild(img)}}close(){super.close();Laya.Tween.clearAll(this);Laya.Tween.clearAll(this)}play(parent=null){super.play(parent);let halfX=game.Define.DeviceW>>1;let radis=0;let showCount=this.data.count;for(let i=0;i<showCount;i++){let img=this.arrStar[i];img.visible=true;img.scaleX=img.scaleY=this.data.minScale;let radian=MathUtil.angleToRadian(360/showCount*i);img.x=Math.cos(radian)*this.data.minRadis;img.y=Math.sin(radian)*this.data.minRadis;let toX=0;let toY=0;if(this.data.isRandRadis){let randRadis=MathUtil.randomRange(this.data.minRadis,this.data.maxRadis);toX=Math.cos(radian)*randRadis;toY=Math.cos(radian)*randRadis}else{toX=Math.cos(radian)*this.data.maxRadis;toY=Math.sin(radian)*this.data.maxRadis}Laya.Tween.to(img,{x:toX,y:toY,alpha:0,rotation:this.data.rotation,scaleX:this.data.maxScale,scaleY:this.data.maxScale},this.data.flyTime,Laya.Ease.backIn,Laya.Handler.create(this,()=>{img.visible=false},[img]),i*5)}}stop(){super.stop()}}effect.OutStarEft=OutStarEft;class OutStarData extends effect.BaseEffectData{constructor(imgSkin,count){super();this.imgSkin="";this.count=8;this.minRadis=0;this.maxRadis=100;this.isRandRadis=false;this.rotation=0;this.flyTime=500;this.minScale=1;this.maxScale=1;this.imgSkin=imgSkin;this.count=count}}effect.OutStarData=OutStarData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class WaitingEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.arrImg=null;this.zoomTimer=0;this.count=0;this.radis=0;this.angle=0;this.arrImg=[]}init(){Laya.timer.loop(1,this,this.update)}setData(effectData){super.setData(effectData);this.data=effectData;this.count=this.data.arrNumber.length>>1;let radis=0;let angle=0;let arr;for(let i=0;i<this.count;i++){radis=this.data.arrNumber[i*2];angle=this.data.arrNumber[i*2+1];let img=new Laya.Image(this.data.skin+(i%this.data.skinCount+1)+".png");this.arrImg.push(img);img.anchorX=img.anchorY=.5;arr=this.getPosByAngle(radis,angle);img.x=arr[0];img.y=arr[1];this.addChild(img)}}close(){super.close();Laya.Tween.clearAll(this);Laya.Tween.clearAll(this)}play(parent=null){super.play(parent)}stop(){super.stop()}update(){if(this.isPlaying){if(this.isZoom){}else{this.zoomTimer++;if(this.zoomTimer>=this.data.zoomTime){this.isZoom=true;this.zoomTimer=0}let arr;for(let i=0;i<this.count;i++){arr=this.addRotation(i,this.data.rotationSpeed);let img=this.arrImg[i];img.x=arr[0];img.y=arr[1];if(this.isZoom){Laya.Tween.to(img,{x:0,y:0,scaleX:.5,scaleY:.5},this.data.zoomSpeed,null,Laya.Handler.create(this,img=>{let index=this.arrImg.indexOf(img);arr=this.addRotation(index,90);Laya.Tween.to(img,{x:arr[0],y:arr[1],scaleX:1,scaleY:1},this.data.zoomSpeed,null,Laya.Handler.create(this,index=>{if(index+1==this.count){this.isZoom=false}},[index]))},[img]),i*5)}}}}}addRotation(index,rotation){let radis=this.data.arrNumber[index*2];let angle=this.data.arrNumber[index*2+1];angle+=rotation;this.data.arrNumber[index*2+1]=angle;return this.getPosByAngle(radis,angle)}getPosByAngle(radis,angle){let radian=MathUtil.angleToRadian(angle);let x=Math.cos(radian)*radis;let y=Math.sin(radian)*radis;return[x,y]}}effect.WaitingEft=WaitingEft;class WaitingData extends effect.BaseEffectData{constructor(skin,skinCount=1,rotationSpeed=1,zoomSpeed=200,zoomTime=1e3){super();this.skin="";this.skinCount=0;this.rotationSpeed=0;this.zoomSpeed=0;this.zoomTime=0;this.skin=skin;this.skinCount=skinCount;this.rotationSpeed=rotationSpeed;this.zoomSpeed=zoomSpeed;this.zoomTime=zoomTime}}effect.WaitingData=WaitingData})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var platform;(function(platform_1){class PlatformManager{constructor(){if(PlatformManager._ins!=null)throw new Error("PlatformManager is single!");PlatformManager._ins=this}static get ins(){if(!this._ins)new PlatformManager;return this._ins}init(data){var platform;let isLocal=false;PlatformManager.mraid=Laya.Browser.window.mraid;if(Laya.Browser.window.wx){platform=PlatformManager.wxPlatform=new platform_1.WxPlatform}else if(Laya.Browser.window.facebook){PlatformManager.mraid=Laya.Browser.window.FbPlayableAd;platform=PlatformManager.fbPlatform=new platform_1.FaceBookPlatform}else if(Laya.Browser.window.applovin){platform=PlatformManager.alPlatform=new platform_1.ApplovinPlatform}else if(Laya.Browser.window.ironsource){PlatformManager.mraid=Laya.Browser.window.dapi;platform=PlatformManager.isPlatform=new platform_1.IronSourcePlatform}else if(Laya.Browser.window.unity){platform=PlatformManager.utPlatform=new platform_1.UnityPlatform}else if(Laya.Browser.window.google){platform=PlatformManager.ggPlatform=new platform_1.GooglePlatform}else if(Laya.Browser.window.mtg){platform=PlatformManager.mtgPlatform=new platform_1.MTGPlatform}else if(Laya.Browser.window.vungle){platform=PlatformManager.vgPlatform=new platform_1.VunglePlatform}else if(Laya.Browser.window.adcolony){platform=PlatformManager.acPlatform=new platform_1.AdColonyPlatform}else if(Laya.Browser.window.tapjoy){PlatformManager.mraid=Laya.Browser.window.TJ_API;platform=PlatformManager.tjPlatform=new platform_1.TapjoyPlatform}else if(Laya.Browser.window.tiktok){platform=PlatformManager.ttPlatform=new platform_1.TiktokPlatform}else if(Laya.Browser.window.qq){platform=PlatformManager.qqPlatform=new platform_1.QQPlatform}else if(Laya.Browser.window.bytedance){platform=PlatformManager.bdPlatform=new platform_1.ByteDancePlatform}else{platform=new platform_1.LocalPlatform;isLocal=true}if(!isLocal){Base64Manager.isUseBase64=true}game.Global.platform=platform;game.Global.platform.init(data)}get HttpConfig(){return{}}static get window(){return Laya.Browser.window}actionCallBack(action,para=null){if(game.Global.platformId==PlatformID.mtg){switch(action){case PlatformAction.DownLoad:if(Laya.Browser.window.install){console.log("调用 window.install");Laya.Browser.window.install()}else{TipManager.ins.showWord("MTG does not support window.install!")}break;case PlatformAction.GameStart:console.log("MTG 主动调用gameStart！");break;case PlatformAction.GameReady:if(Laya.Browser.window.gameReady){console.log("调用 window.gameReady");Laya.Browser.window.gameReady()}else{TipManager.ins.showWord("MTG does not support window.gameReady!")}break;case PlatformAction.GameEnd:if(Laya.Browser.window.gameEnd){console.log("调用 window.gameEnd");Laya.Browser.window.gameEnd()}else{TipManager.ins.showWord("MTG does not support window.gameEnd!")}break;case PlatformAction.GameClose:console.log("MTG 主动调用gameClose！");break}}else if(game.Global.platformId==PlatformID.Is){let NUC=Laya.Browser.window.NUC;if(!NUC){console.log("当前为IronSource渠道，NUC不存在，无法上报用户行为追踪！");return}switch(action){case PlatformAction.DownLoad:if(NUC.trigger&&NUC.trigger.convert){console.log("调用 NUC.trigger.convert");NUC.trigger.convert()}else{TipManager.ins.showWord("IronSourc does not support NUC.trigger.convert!")}break;case PlatformAction.GameStart:if(NUC.trigger&&NUC.trigger.startLevel){console.log("调用 NUC.trigger.startLevel");NUC.trigger.startLevel()}else{TipManager.ins.showWord("IronSource does not support NUC.trigger.startLevel!")}break;case PlatformAction.GameReady:if(Laya.Browser.window.gameReady){console.log("调用 window.gameReady");Laya.Browser.window.gameReady()}else{TipManager.ins.showWord("IronSource does not support window.gameReady!")}break;case PlatformAction.GameEnd:if(NUC.trigger&&NUC.trigger.endGame){console.log("调用 NUC.trigger.endGame");NUC.trigger.endGame("win")}else{TipManager.ins.showWord("IronSource does not support NUC.trigger.endGame!")}break;case PlatformAction.GameCustom:if(NUC.event&&NUC.event.send){console.log("调用 NUC.event.send");NUC.event.send("mouseclick",para)}else{TipManager.ins.showWord("IronSource does not support NUC.event.send!")}break}}else if(game.Global.platformId==PlatformID.Vg){switch(action){case PlatformAction.DownLoad:break;case PlatformAction.GameStart:break;case PlatformAction.GameReady:break;case PlatformAction.GameEnd:if(parent){console.log("调用 parent.postMessage('complete','*')");parent.postMessage("complete","*")}else{TipManager.ins.showWord("Vungle does not support parent.postMessage!")}break;case PlatformAction.GameCustom:break}}else if(game.Global.platformId==PlatformID.Tj){switch(action){case PlatformAction.DownLoad:break;case PlatformAction.GameStart:if(PlatformManager.mraid&&PlatformManager.mraid.setPlayableAPI){PlatformManager.mraid.setPlayableAPI({skipAd:function(){}});console.log("调用 window.TJ_API.setPlayableAPI")}else{TipManager.ins.showWord("Tapjoy does not support window.TJ_API.setPlayableAPI!")}break;case PlatformAction.GameReady:break;case PlatformAction.GameEnd:if(PlatformManager.mraid&&PlatformManager.mraid.objectiveComplete){PlatformManager.mraid.objectiveComplete();console.log("调用 window.TJ_API.objectiveComplete")}else{TipManager.ins.showWord("Tapjoy does not support window.TJ_API.objectiveComplete!")}if(PlatformManager.mraid&&PlatformManager.mraid.gameplayFinished){PlatformManager.mraid.gameplayFinished();console.log("调用 window.TJ_API.gameplayFinished")}else{TipManager.ins.showWord("Tapjoy does not support window.TJ_API.gameplayFinished!")}break;case PlatformAction.GameCustom:break}}else{}}}platform_1.PlatformManager=PlatformManager;let PlatformID;(function(PlatformID){PlatformID[PlatformID["None"]=0]="None";PlatformID[PlatformID["Wx"]=1]="Wx";PlatformID[PlatformID["Fb"]=2]="Fb";PlatformID[PlatformID["Al"]=3]="Al";PlatformID[PlatformID["Is"]=4]="Is";PlatformID[PlatformID["Ut"]=5]="Ut";PlatformID[PlatformID["Gg"]=6]="Gg";PlatformID[PlatformID["Vg"]=7]="Vg";PlatformID[PlatformID["Ac"]=8]="Ac";PlatformID[PlatformID["Tj"]=9]="Tj";PlatformID[PlatformID["mtg"]=10]="mtg";PlatformID[PlatformID["Tt"]=11]="Tt";PlatformID[PlatformID["Qq"]=12]="Qq";PlatformID[PlatformID["Bd"]=13]="Bd"})(PlatformID=platform_1.PlatformID||(platform_1.PlatformID={}));let LangType;(function(LangType){LangType[LangType["Zh"]=0]="Zh";LangType[LangType["En"]=1]="En"})(LangType=platform_1.LangType||(platform_1.LangType={}));let PlatformAction;(function(PlatformAction){PlatformAction[PlatformAction["None"]=0]="None";PlatformAction[PlatformAction["DownLoad"]=1]="DownLoad";PlatformAction[PlatformAction["GameEnd"]=2]="GameEnd";PlatformAction[PlatformAction["GameReady"]=3]="GameReady";PlatformAction[PlatformAction["GameStart"]=4]="GameStart";PlatformAction[PlatformAction["GameClose"]=5]="GameClose";PlatformAction[PlatformAction["GameCustom"]=6]="GameCustom"})(PlatformAction=platform_1.PlatformAction||(platform_1.PlatformAction={}))})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){var EventManager=game.common.EventManager;var NoticeEvent=game.common.NoticeEvent;class LocalPlatform{constructor(){this.window=platform.PlatformManager.window;game.Global.platformId=platform.PlatformID.None;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;EventManager.ins.init()}init(data){if(data){this.getRandomShareFunc=data.getRandomShare;this.isCanPlayVideoFunc=data.sCanPlayVideo;this.getAdDataFunc=data.getAdData;this.getAdVideoDataFunc=data.getAdVideoData;console.log("平台初始化："+data.getRandomShare)}if(game.Global.platformId==platform.PlatformID.None){EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}EventManager.ins.on(NoticeEvent.GAME_OVER,this,()=>{platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameEnd)})}initSkinGame(){}login(){this.loginSuccess()}loginSuccess(){EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getUserInfo(){return this.userInfo}initItem(){console.log("需要平台实现此功能")}saveItem(ID,count,type){console.log("需要平台实现此功能")}scoreUp(rank,score){console.log("需要平台实现此功能")}share(func,queryKey){console.log("需要平台实现此功能")}createBannerAd(posKey){console.log("需要平台实现此功能")}showBannerAd(isShow){console.log("需要平台实现此功能")}destroyBannerAd(){console.log("需要平台实现此功能")}createVideoAd(posKey,success){console.log("创建广告："+posKey)}addMoreGameBtn(parent){console.log("需要平台实现此功能 微信独有")}createBrandSprite(parent,x,y){console.log("需要平台实现此功能 微信独有")}postMsg(postName,obj){console.log("需要平台实现此功能 微信独有")}shake(isShort,delay){console.log("需要平台实现此功能")}saveImageToPhotosAlbum(url){console.log("保存图片接口没有实现")}setUserCloudStorage(key,value){console.log("云端保存数据接口没有实现")}getLocalImage(type){console.log("需要平台实现此功能")}onShowCallBack(res){console.log("小游戏获得焦点，进入前台运行")}onHideCallBack(){console.log("小游戏失去焦点，进入后台运行");Laya.SoundManager.stopMusic()}}platform.LocalPlatform=LocalPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class AdColonyPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Ac;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("AdColony 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.AdColonyPlatform=AdColonyPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class ApplovinPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Al;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Applovin 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.ApplovinPlatform=ApplovinPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class ByteDancePlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Bd;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER);Laya.Browser.window.gameStart=()=>{platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameStart)}}initGameSkin(){}login(){platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameReady);this.loginSuccess()}loginSuccess(){console.log("bytedance 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.ByteDancePlatform=ByteDancePlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class FaceBookPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Fb;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("FaceBook 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.FaceBookPlatform=FaceBookPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class GooglePlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Gg;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Google 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.GooglePlatform=GooglePlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class IronSourcePlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Is;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("IronSource 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.IronSourcePlatform=IronSourcePlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class MTGPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.mtg;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER);Laya.Browser.window.gameStart=()=>{platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameStart)}}initGameSkin(){}login(){platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameReady);this.loginSuccess()}loginSuccess(){console.log("MTG 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.MTGPlatform=MTGPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class QQPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Qq;game.Define.langId=platform.LangType.Zh;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER);Laya.Browser.window.gameStart=()=>{platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameStart)}}initGameSkin(){}login(){platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameReady);this.loginSuccess()}loginSuccess(){console.log("QQ 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.QQPlatform=QQPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class TapjoyPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Tj;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameStart);EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Tapjoy 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score)}}platform.TapjoyPlatform=TapjoyPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class TiktokPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Tt;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER);Laya.Browser.window.gameStart=()=>{platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameStart)}}initGameSkin(){}login(){platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameReady);this.loginSuccess()}loginSuccess(){console.log("Tiktok 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.TiktokPlatform=TiktokPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class UnityPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Ut;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Unity 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.UnityPlatform=UnityPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class VunglePlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Vg;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Vungle 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.VunglePlatform=VunglePlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){var EventManager=game.common.EventManager;var NoticeEvent=game.common.NoticeEvent;var OpenManager=game.common.OpenManager;class WxPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Wx;game.Define.langId=platform.LangType.Zh;game.Define.isLocal=false;game.Define.serverHttp="http://192.168.2.104:3000/";this.wx=Laya.Browser.window.wx;this.wxFileMgr=this.wx.getFileSystemManager()}init(data){super.init(data);this.initSysInfo();let th=this;this.wx.onShow(res=>{this.onShowCallBack(res)});this.wx.onHide(()=>{this.onHideCallBack()});this.wx.showShareMenu({withShareTicket:true,success:e=>{console.log("wx.showShareMenu成功")},fail:e=>{console.log("wx.showShareMenu失敗")}});this.wx.getSetting({success(res){var authSetting=res.authSetting;if(authSetting["scope.userInfo"]===true){console.log("用户已授权");th.getWxUserInfo()}else if(authSetting["scope.userInfo"]===false){console.log("用户已拒绝授权");th.wx.showModal({title:"提示",content:"继续游戏需要获得你的授权",success(res){if(res.confirm){th.wx.openSetting({success(res){th.getWxUserInfo()}})}else if(res.cancel){console.log("用户点击取消")}else{}}})}else{console.log("未询问过用户授权");th.wx.authorize({scope:"scope.userInfo",success(){th.getWxUserInfo()},fail(){th.getWxUserInfo()}})}}});this.initSkinGame()}getWxUserInfo(){let th=this;this.wx.onShareAppMessage(()=>{var data=this.getRandomShareFunc?this.getRandomShareFunc.run():{title:"分享测试",imageUrl:""};var query="openid="+game.Global.openId+"&uid="+game.Global.UID;console.log("wx.onShareAppMessage openId="+game.Global.openId+" uid="+game.Global.UID);return{title:data.title,imageUrl:data.imageUrl,query:query,success:res=>{game.Global.shareTicket=res.shareTickets;console.log("wx.onShareAppMessage success!shareTicket="+game.Global.openId)}}});this.wx.getUserInfo({success(res){th.userInfo=res.userInfo;EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)},fail(){EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}})}initSkinGame(){console.log("当前 GameID:"+game.Define.gameId+" AppID:"+game.Define.appId)}login(){let ths=this;this.wx.login({timeout:1e4,success:function(e){console.log("微信登录成功！ "+e.errMsg+"！code="+e.code);game.Global.code=e.code;game.Global.platform.loginSuccess()},fail:function(e){console.log(e.errMsg+"！")}})}loginSuccess(){var fromid;var query=game.Global.query;if(query){if(query.hasOwnProperty("openid")){if(query.hasOwnProperty("gold")){fromid=query.openid}}if(query.hasOwnProperty("signGold")){}}OpenManager.ins.setLogin();EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}initItem(){}saveItem(ID,count,type){}share(func,queryKey){this.shareAppSuccess=func;var data=this.getRandomShareFunc?this.getRandomShareFunc.run():{title:"分享一个好玩的游戏",imageUrl:"res/atlas/not/share.jpg"};var query="openid="+game.Global.openId+"&uid="+game.Global.UID;if(queryKey!=null){query+="&"+queryKey}this.wx.updateShareMenu({success:e=>{this.wx.shareAppMessage({title:data.title,imageUrl:data.imageUrl,query:query,success(res){}});console.log("分享标题："+data.title+" 分享内容图片："+data.imageUrl+" query="+query)}})}createBannerAd(adName){if(this.bannerAd){this.bannerAd.destroy()}let ad=this.getAdDataFunc?this.getAdDataFunc.runWith(adName):null;if(!ad){console.log("未找到图片广告配置："+ad.adName);return}this.bannerAd=this.wx.createBannerAd({adUnitId:ad.adUnitId,style:{left:ad.left,top:ad.top,width:ad.width,height:ad.height}});this.bannerAd.onError(err=>{console.log(err)});this.bannerAd.onLoad(()=>{console.log("banner 广告加载成功")});this.bannerAd.onResize(res=>{let width=res.width,height=res.height;this.bannerAd.style.top=window.innerHeight-height});this.showBannerAd(true)}showBannerAd(isShow){if(!this.bannerAd){return}if(isShow){this.bannerAd.show()}else{this.bannerAd.hide()}}destroyBannerAd(){if(this.bannerAd){this.bannerAd.offError();this.bannerAd.offLoad();this.bannerAd.offResize();this.bannerAd.destroy();this.bannerAd=null}}createVideoAd(adName,callBack){let ad=this.getAdVideoDataFunc?this.getAdVideoDataFunc.runWith(adName):null;if(!ad){console.log("未找到视频广告配置："+adName);return}if(ad.playCount>=ad.maxPlayCount){console.log("视频播放超过上限："+adName);return}if(this.isCanPlayVideoFunc&&!this.isCanPlayVideoFunc.runWith(adName)){return}this.videoAd=this.wx.createRewardedVideoAd({adUnitId:ad.adUnitId});this.videoAd.onClose(res=>{if(res&&res.isEnded||res===undefined){callBack&&callBack.run()}else{this.wx.showModal({title:"提示",content:"视频未播放完"})}});this.wx.showLoading({title:"视频加载中",mask:true});this.videoAd.load().then(()=>{this.wx.hideLoading();return this.videoAd.show()}).catch(err=>{console.log(err);this.wx.hideLoading();this.wx.showModal({title:"提示",content:"视频加载失败, 请稍后再试"})})}shake(isShort,delay){console.log("调用微信手机震动");if(isShort){this.wx.vibrateShort(delay)}else{this.wx.vibrateLong(delay)}}saveImageToPhotosAlbum(filePath){var file=null;var md5=file.md5;var jdPath="";this.wx.saveImageToPhotosAlbum({filePath:jdPath,success:function(res){console.log("保存图片成功")},fail:function(e){console.log("保存图片失败！"+JSON.stringify(e))}})}getLocalImage(type){var that=this;this.wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:res=>{var filePath=res.tempFilePaths[0];var session_key=this.wx.getStorageSync("session_key");var base64=this.wx.getFileSystemManager().readFileSync(filePath,"base64");let data={};data["image"]=base64;let url="";let access_token="24.3fa0c0561fbfacf7b51cdca51328247e.2592000.1554966363.282335-15738709";if(type==0){url="https://aip.baidubce.com/rest/2.0/ocr/v1/idcard?access_token="+access_token;data["id_card_side"]="front"}else if(type==1){url="https://aip.baidubce.com/rest/2.0/ocr/v1/general_basic?access_token="+access_token}this.wx.request({url:url,data:data,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},success:function(res){console.log(res.data);EventManager.ins.event(NoticeEvent.AI_IMAGE_TO_WORD,res.data)}})},fail:function(error){console.error("调用本地相册文件时出错");console.warn(error)},complete:function(){}})}setUserCloudStorage(key,value){console.log("开始保存数据到云端！");var KVDataList=[{key:key,value:String(value)}];this.wx.setUserCloudStorage({KVDataList:KVDataList,success:function(){console.log("保存数据到云端！")},fail:function(){}})}postMsg(cmd,data){var openDataContext=this.wx.getOpenDataContext();openDataContext.postMessage({cmd:cmd,data:data})}onShowCallBack(res){super.onShowCallBack(res);game.Global.query=res.query;game.Global.shareTicket=res.shareTicket;console.log("wx onShow! query="+JSON.stringify(game.Global.query)+",shareTicket="+game.Global.shareTicket);if(game.Global.shareTicket!=null&&game.Global.shareTicket!=""){OpenManager.ins.setShareTicket();console.log("微信转发已经提交服务器")}if(this.shareAppSuccess!=null){this.shareAppSuccess();this.shareAppSuccess=null}}onHideCallBack(){super.onHideCallBack()}initSysInfo(){var res=this.wx.getSystemInfoSync();game.Global.BRAND=res.brand;game.Global.MODEL=res.model;game.Global.SYSTEM=res.system;console.log("brand:"+game.Global.BRAND+",model:"+game.Global.MODEL+",system:"+game.Global.SYSTEM);if(this.wx.getUpdateManager instanceof Function){var t=this.wx.getUpdateManager();t.onCheckForUpdate(function(t){console.log("小游戏是否有新版本："+t.hasUpdate)}),t.onUpdateReady(function(){t.applyUpdate()}),t.onUpdateFailed(function(){})}}showModal(title,content,isCancel){this.wx.showModal({title:title,content:content,showCancel:isCancel})}removeUserCloudStorage(key){this.wx.removeUserCloudStorage({KVDataList:[key],success:function(){console.log("托管数据"+key+"删除成功")},fail:function(){console.log("托管数据"+key+"删除失败")}})}}platform.WxPlatform=WxPlatform;let WeChatCall;(function(WeChatCall){WeChatCall[WeChatCall["FAIL"]=0]="FAIL";WeChatCall[WeChatCall["SUCCESS"]=1]="SUCCESS";WeChatCall[WeChatCall["NO_MINI"]=2]="NO_MINI"})(WeChatCall||(WeChatCall={}))})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var king;(function(king){var BaseDisplay=game.display.BaseDisplay;class BaseBone extends BaseDisplay{constructor(type,cacheType=0){super();this._objId=0;this.cacheType=0;this.kingType="boy";this.isLoop=false;this.layerName=null;this._randIndex=0;this._randName="";this.isLoad=false;this._objId=king.BoneManager.ins.boneIndex++;this.kingType=type;this.cacheType=cacheType}get objId(){return this._objId}init(){}onAdd(){king.BoneManager.ins.addBone(this);EventManager.ins.on(NoticeEvent.BONE_TEMP_LOAD_FINISH,this,this.BONE_TEMP_LOAD_FINISH);if(this.isLoad){this.playByNameOrIndex()}else{}}onRemove(){king.BoneManager.ins.dicBone.remove(this.objId);king.BoneManager.ins.removeBone(this);EventManager.ins.off(NoticeEvent.BONE_TEMP_LOAD_FINISH,this,this.BONE_TEMP_LOAD_FINISH)}BONE_TEMP_LOAD_FINISH(evt){if(evt.data==this.kingType&&!this._sk){this.setSkin(this.kingType,this.cacheType)}}setSkin(boneName,cacheType=0){let temp=king.BoneManager.ins.getTemp(boneName);if(!temp){return}let sk=temp.buildArmature(cacheType);if(sk){this._sk=sk;this._sk.on(Laya.Event.STOPPED,this,this.onStop);this._sk.on(Laya.Event.COMPLETE,this,this.onComplete);this.addChild(this._sk);this.isLoad=true}this.playByNameOrIndex()}playByNameOrIndex(){if(this._randName==null||this._randName==""){if(this._randIndex>=this._sk.getAnimNum()){this._randIndex=0}this._sk.play(this._randIndex++,this.isLoop)}else{this._sk.play(this._randName,this.isLoop)}}play(isLoop=false,name="",parent=null){this.isLoop=isLoop;this._randName=name;if(this.isDisplay){}else{if(parent instanceof Laya.Sprite){parent.addChild(this)}else{scene.LayerManager.ins.addChild(this,parent?parent:scene.LayerName.scene_king)}}}stop(){if(this._sk){this._sk.stop()}this.removeSelf();king.BoneManager.ins.removeBone(this)}setActionType(at){this.curActionType=at;if(this._sk){if(at<this._sk.getAnimNum()){this._sk.play(at,true)}}}setActionState(as){this.curActionState=as}onStop(ev){console.log("Bone onStop "+ev)}onComplete(ev){console.log("Bone onComplete "+ev);if(!this.isLoop){}if(this.callBack){this.callBack.run()}}}king.BaseBone=BaseBone})(king=scene.king||(scene.king={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var king;(function(king){var BaseAnimation=game.display.BaseAnimation;class BaseKing extends BaseAnimation{constructor(){super();this.objId=0;this.clsName="";this.isLoad=false;this.dicAction=new Dictionary;this.spFoot=new Laya.Sprite;this.addChild(this.spFoot);this.spBody=new Laya.Sprite;this.addChild(this.spBody);this.spBody.addChild(this.anim);this.spHead=new Laya.Sprite;this.addChild(this.spHead);this.spEft=new Laya.Sprite;this.addChild(this.spEft)}init(){}setSkin(skinData,isAdd=true){this.isLoad=false;if(skinData){this.skinData=skinData}else{console.log("this.skinData is null!")}if(this.skinData.arrAction&&this.skinData.arrAction.length>0){let action;this.dicAction=new Dictionary;for(let i=0;i<this.skinData.arrAction.length;i++){action=this.skinData.arrAction[i];this.dicAction.add(action.actionName,action);Laya.Animation.createFrames(this.aniUrls(action.actionName,action.frameCount),this.skinData.kingType+"_"+action.actionName)}}else{for(let i=0;i<this.skinData.cutRow;i++){Laya.Animation.createFrames(this.aniUrls(i.toString(),this.skinData.cutCol),this.skinData.kingType+"_"+i)}}this.isLoad=true;this.setActionType(this.curActionType);if(isAdd){king.KingManager.ins.addKing(this)}}regNextAction(atcionType,actionNaxtType){if(!this.arrNextAction){this.arrNextAction=[]}this.arrNextAction[atcionType]=actionNaxtType}setActionType(at,isLoop=true){if(at==undefined||at<0||this.curActionState==ActionState.DEAD){return}let actionName=this.skinData.kingType+"_"+at+"_"+this.curActionDirect;if(Laya.Animation.framesMap[actionName]==null){console.log("请检查动作表："+actionName+" 是否存在！");if(at==ActionType.DEAD||at==ActionType.DEADCRIT){this.curActionState=ActionState.DEAD}return}if(this.isLoad){this.visible=true;let action=this.dicAction.get(at+"_"+this.curActionDirect);if(action){isLoop=action.isLoop;this.spBody.width=action.width;this.spBody.height=action.height;this.spBody.pivot(action.pivotX,action.pivotY);this.setInterval(action.frameRate)}this.anim.play(0,isLoop,actionName);this.curActionType=at;this.curActionState=this.getActionState(at)}}setActionDirect(at){if(this.curDirect==at){return false}let isDirect=true;let tempAticonDirect=at;switch(at){case ActionDirect.Left:case ActionDirect.Right:tempAticonDirect=ActionDirect.Right;break;case ActionDirect.Up:break;case ActionDirect.Down:break;case ActionDirect.Left_up:case ActionDirect.Right_up:tempAticonDirect=ActionDirect.Right_up;break;case ActionDirect.Left_down:case ActionDirect.Right_down:tempAticonDirect=ActionDirect.Right_down;break;default:isDirect=false;break}if(isDirect){this.curDirect=at;this.curActionDirect=tempAticonDirect;if(at==ActionDirect.Left||at==ActionDirect.Left_up||at==ActionDirect.Left_down){this.spBody.skewY=180}else{this.spBody.skewY=0}}return true}getActionState(at){let ret=null;switch(at){case ActionType.Wait:ret=ActionState.NONE;break;case ActionType.SHOW:ret=ActionState.SHOW;break;case ActionType.WALK:case ActionType.RUN:ret=ActionState.MOVE;break;case ActionType.ATTACK:case ActionType.ATTACK1:case ActionType.ATTACK2:case ActionType.ATTACK3:case ActionType.ATTACK4:case ActionType.ATTACK5:case ActionType.ATTACK6:case ActionType.ATTACK7:case ActionType.ATTACK8:case ActionType.ATTACK9:case ActionType.ATTACK10:case ActionType.SKILL1:case ActionType.SKILL2:case ActionType.SKILL3:case ActionType.SKILL4:case ActionType.SKILL5:case ActionType.SKILL6:case ActionType.SKILL7:case ActionType.SKILL8:case ActionType.SKILL9:case ActionType.SKILL10:ret=ActionState.ATTACK;break;case ActionType.ATTACKED:ret=ActionState.ATTACKED;break;case ActionType.JUMP:case ActionType.ROLL:case ActionType.SHOW:ret=ActionState.JUMP;break;case ActionType.DEAD:case ActionType.DEADCRIT:ret=ActionState.DEAD;break;default:break}return ret}setActionState(as){this.curActionState=as}onLabel(ev){console.log(`complte `+ev)}onStop(ev){console.log(`onStop `+ev);this.visible=false}onComplete(ev){if(this.anim.isPlaying){}else{let actionType=-1;if(this.arrNextAction&&this.curActionType<this.arrNextAction.length){actionType=this.arrNextAction[this.curActionType]}if(actionType>-1){this.setActionType(actionType)}else{}}}aniUrls(actionName,length){actionName=this.skinData.atlasName+"/"+this.skinData.kingType+"_"+actionName;return BaseAnimation.aniUrls(actionName,length)}}king.BaseKing=BaseKing;class Action{constructor(cfg,isLoop=true){this.actionType=cfg.actionType;this.actionDirect=cfg.actionDirect;this._actionName=cfg.actionType+"_"+cfg.actionDirect;this.frameCount=cfg.frameCount;this.frameRate=cfg.frameRate<=0?50:cfg.frameRate;this.width=cfg.width;this.height=cfg.height;this.pivotX=cfg.offX;this.pivotY=cfg.offY;this.isLoop=isLoop}get actionName(){return this._actionName}}king.Action=Action;class SkinData{constructor(atlasName,kingType,arrAction,cutRow=0,cutCol=0){this.atlasName="";this.kingType="";this.cutRow=1;this.cutCol=1;this.atlasName=atlasName;this.kingType=kingType;this.cutRow=cutRow;this.cutCol=cutCol;this.arrAction=arrAction}}king.SkinData=SkinData;let ActionType;(function(ActionType){ActionType[ActionType["Wait"]=0]="Wait";ActionType[ActionType["WALK"]=1]="WALK";ActionType[ActionType["RUN"]=2]="RUN";ActionType[ActionType["JUMP"]=3]="JUMP";ActionType[ActionType["ROLL"]=4]="ROLL";ActionType[ActionType["SHOW"]=5]="SHOW";ActionType[ActionType["POS6"]=6]="POS6";ActionType[ActionType["POS7"]=7]="POS7";ActionType[ActionType["POS8"]=8]="POS8";ActionType[ActionType["POS9"]=9]="POS9";ActionType[ActionType["POS10"]=10]="POS10";ActionType[ActionType["ATTACK"]=11]="ATTACK";ActionType[ActionType["ATTACKED"]=12]="ATTACKED";ActionType[ActionType["DEAD"]=13]="DEAD";ActionType[ActionType["DEADCRIT"]=14]="DEADCRIT";ActionType[ActionType["POS15"]=15]="POS15";ActionType[ActionType["POS16"]=16]="POS16";ActionType[ActionType["POS17"]=17]="POS17";ActionType[ActionType["POS18"]=18]="POS18";ActionType[ActionType["POS19"]=19]="POS19";ActionType[ActionType["POS20"]=20]="POS20";ActionType[ActionType["ATTACK1"]=21]="ATTACK1";ActionType[ActionType["ATTACK2"]=22]="ATTACK2";ActionType[ActionType["ATTACK3"]=23]="ATTACK3";ActionType[ActionType["ATTACK4"]=24]="ATTACK4";ActionType[ActionType["ATTACK5"]=25]="ATTACK5";ActionType[ActionType["ATTACK6"]=26]="ATTACK6";ActionType[ActionType["ATTACK7"]=27]="ATTACK7";ActionType[ActionType["ATTACK8"]=28]="ATTACK8";ActionType[ActionType["ATTACK9"]=29]="ATTACK9";ActionType[ActionType["ATTACK10"]=30]="ATTACK10";ActionType[ActionType["SKILL1"]=31]="SKILL1";ActionType[ActionType["SKILL2"]=32]="SKILL2";ActionType[ActionType["SKILL3"]=33]="SKILL3";ActionType[ActionType["SKILL4"]=34]="SKILL4";ActionType[ActionType["SKILL5"]=35]="SKILL5";ActionType[ActionType["SKILL6"]=36]="SKILL6";ActionType[ActionType["SKILL7"]=37]="SKILL7";ActionType[ActionType["SKILL8"]=38]="SKILL8";ActionType[ActionType["SKILL9"]=39]="SKILL9";ActionType[ActionType["SKILL10"]=40]="SKILL10"})(ActionType=king.ActionType||(king.ActionType={}));let ActionDirect;(function(ActionDirect){ActionDirect[ActionDirect["None"]=0]="None";ActionDirect[ActionDirect["Up"]=1]="Up";ActionDirect[ActionDirect["Right_up"]=2]="Right_up";ActionDirect[ActionDirect["Right"]=3]="Right";ActionDirect[ActionDirect["Right_down"]=4]="Right_down";ActionDirect[ActionDirect["Down"]=5]="Down";ActionDirect[ActionDirect["Left_down"]=6]="Left_down";ActionDirect[ActionDirect["Left"]=7]="Left";ActionDirect[ActionDirect["Left_up"]=8]="Left_up"})(ActionDirect=king.ActionDirect||(king.ActionDirect={}));let ActionState;(function(ActionState){ActionState[ActionState["NONE"]=0]="NONE";ActionState[ActionState["SHOW"]=1]="SHOW";ActionState[ActionState["MOVE"]=2]="MOVE";ActionState[ActionState["JUMP"]=3]="JUMP";ActionState[ActionState["ATTACK"]=4]="ATTACK";ActionState[ActionState["ATTACKED"]=5]="ATTACKED";ActionState[ActionState["DEAD"]=6]="DEAD"})(ActionState=king.ActionState||(king.ActionState={}))})(king=scene.king||(scene.king={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var king;(function(king_1){class King extends king_1.BaseKing{constructor(){super();this.atkDistance=1;this.isAtkCri=false;this.isAtkedCri=false;this.atkDelay=0;this.atkIndex=0;this.atkCD=1e3;this.lastAtkTime=0;this.atkedRadis=50;this.atkedX=0;this.atkedY=0;this.moveSpeed=1;this._isLongAtk=false;this.lvl=1;this.hp=1;this.hpMax=100;this.mp=1;this.atkBasic=0;this.atkSkill=0;this.atkEquip=0;this.cri=0;this.def=1;this.hitRate=100;this.criRate=0;this.camp=1;this.curFrame=0;this.curFixedIndex=0;this.hpBar=new Laya.ProgressBar;this.hpBar.anchorX=this.hpBar.anchorY=.5;this.spHead.addChild(this.hpBar);this.spDebug=new Laya.Sprite;this.addChild(this.spDebug);this.startPoint=new Laya.Point;this.endPoint=new Laya.Point;this._atkedPoint=new Laya.Point;this.arrAtkId=[];this.arrSkillId=[];this.dicCD=new Dictionary;this.arrFixedPoint=[]}init(){super.init()}setSkin(skinData,isAdd=true){super.setSkin(skinData,isAdd);let arrSkillConfig=SkillManager.ins.getKingCfg(this.skinData.kingType);if(arrSkillConfig){let cfgAtk=null;let cfgSkill=null;this.arrAtkId=[];for(let cfg of arrSkillConfig){if(!cfg)continue;if(cfg.skillType==0){this.arrAtkId.push(cfg.skillId);cfgAtk=cfg}else{this.arrSkillId.push(cfg.skillId);this._isLongAtk=cfg.skillType==1;if(this.camp==1)cfgSkill=cfg}}if(!cfgAtk){cfgAtk=cfgSkill}if(cfgAtk){this.atkSkill=cfgAtk.atk;this.atkDistance=cfgAtk.atkDistance;this.atkCD=cfgAtk.atkCD}}}update(){if(this.curActionState!=king_1.ActionState.DEAD){if(this.curActionState!=king_1.ActionState.NONE){this.startPoint.setTo(this.x,this.y)}this.getNextPoint()}this.curFrame++}move(){if(game.Define.gameType==game.GameType.over_look){let angle=MathUtil.getTwoPointAngle(this.x,this.y,this.endPoint.x,this.endPoint.y);this.spBody.rotation=MathUtil.getFromAngle(angle);let radian=MathUtil.angleToRadian(this.spBody.rotation);this.x+=Math.cos(radian)*this.moveSpeed;this.y+=Math.sin(radian)*this.moveSpeed;if(!this.isMoveByDistance()){this.attack(this.atkTarget)}}else if(game.Define.gameType==game.GameType.h_game){this.x<this.atkTarget.x?this.setActionDirect(king_1.ActionDirect.Right):this.x>this.atkTarget.x?this.setActionDirect(king_1.ActionDirect.Left):null;let toY=this.y;if(Math.abs(this.y-this.atkTarget.y)>this.moveSpeed){toY=this.y<this.atkTarget.y?this.y+this.moveSpeed:this.y-this.moveSpeed}if(this.curDirect==king_1.ActionDirect.Left){if(this.x-this.moveSpeed-this.atkDistance>this.atkTarget.x){this.pos(this.x-this.moveSpeed,toY)}else if(toY!=this.y&&!this._isLongAtk){this.pos(this.x,toY)}else{this.attack()}}else if(this.curDirect==king_1.ActionDirect.Right){if(this.x+this.moveSpeed+this.atkDistance<this.atkTarget.x){this.pos(this.x+this.moveSpeed,toY)}else if(toY!=this.y&&!this._isLongAtk){this.pos(this.x,toY)}else{this.attack(this.atkTarget)}}else{}}else if(game.Define.gameType==game.GameType.v_game){this.y<this.atkTarget.y?this.setActionDirect(king_1.ActionDirect.Down):this.y>this.atkTarget.y?this.setActionDirect(king_1.ActionDirect.Up):null;if(this.curDirect==king_1.ActionDirect.Up){if(this.y-this.moveSpeed-this.atkDistance>this.atkTarget.y){this.pos(this.x,this.y-this.moveSpeed)}else{this.attack()}}else if(this.curDirect==king_1.ActionDirect.Down){if(this.y+this.moveSpeed+this.atkDistance<this.atkTarget.y){this.pos(this.x,this.y+this.moveSpeed)}else{this.attack()}}else{}}else if(game.Define.gameType==game.GameType.rpg){let angle=MathUtil.getTwoPointAngle(this.x,this.y,this.endPoint.x,this.endPoint.y);let realAngle=MathUtil.getFromAngle(angle);let dir=MathUtil.getDirByRotate(realAngle);if(this.setActionDirect(dir)){this.setActionType(this.curActionType)}let radian=MathUtil.angleToRadian(realAngle);this.x+=Math.cos(radian)*this.moveSpeed;this.y+=Math.sin(radian)*this.moveSpeed;if(!this.isMoveByDistance()){this.attack()}}else{}}getNextPoint(){let toX=0,toY=0;if(this.arrFixedPoint&&this.curFixedIndex<this.arrFixedPoint.length){toX=this.arrFixedPoint[this.curFixedIndex][0];toY=this.arrFixedPoint[this.curFixedIndex][1]}else if(this.atkTarget){toX=this.atkTarget.x;toY=this.atkTarget.y}this.endPoint.setTo(toX,toY);return this.endPoint}isMoveByDistance(){let distance=MathUtil.getDistance(this.startPoint,this.endPoint);if(this.arrFixedPoint&&this.curFixedIndex<this.arrFixedPoint.length){if(distance<=this.moveSpeed){this.curFixedIndex++}if(this.curFixedIndex==this.arrFixedPoint.length){return this.atkTarget?true:false}return true}else if(this.atkTarget){return distance>this.atkDistance+this.moveSpeed}else{return false}}checkMoveDir(fromX,fromY,toX,toY,isEightDir=true){let radian=Math.atan2(fromY-toY,fromX-toX);let angle=MathUtil.radianToAngle(radian);if(isEightDir){return 0}else{return angle}}attack(king=null){let tempActionState=this.curActionState;this.curActionState=king_1.ActionState.ATTACK;let ret=false;if(this.arrAtkId.length>0){ret=this.playSkill(!king?this.atkTarget:king)}else if(this.arrSkillId.length>0){ret=this.playSkill(!king?this.atkTarget:king,this.arrSkillId[0])}else{}return ret}playSkill(target,skillId=-1){if(this.curActionState==king_1.ActionState.DEAD){return}if(skillId==-1){skillId=this.getRandAtkIndex()}let skillConfig=SkillManager.ins.getCfg(skillId);if(!skillConfig){console.warn("King.ts playSkill ：技能ID "+skillId+" 找不到配置！");return false}let key="skill_"+(skillConfig.skillType>0?skillId:0);if(this.dicCD.hasKey(key)){this.lastAtkTime=this.dicCD.get(key)}else{this.lastAtkTime=Laya.timer.currTimer-skillConfig.atkCD+this.atkDelay;this.dicCD.add(key,Laya.timer.currTimer)}if(Laya.timer.currTimer-this.lastAtkTime>=skillConfig.atkCD){this.dicCD.add(key,Laya.timer.currTimer);this.setActionType(skillConfig.actionType,false);this.lastAtkTime=Laya.timer.currTimer;let rate=MathUtil.randomRange(1,1e4);if(this.criRate>=rate){this.isAtkCri=true;if(target)target.isAtkedCri=true;if(this&&this.eftAtkCri){this.eftAtkCri.playFrame(false,this)}}else{this.isAtkCri=false;if(target)target.isAtkedCri=false;if(this&&this.eftAtk){this.eftAtk.playFrame(false,this)}}let skillData=new SkillData(skillConfig,this,target);let skill=SkillManager.ins.getSkill(skillData);skill.play();return true}else{return false}}attacked(king,skillId=0,extraAtk=0){if(this.curActionState==king_1.ActionState.DEAD||king&&king.curActionState==king_1.ActionState.DEAD){return}if(this.isAtkedCri){if(this.eftAtkedCri){this.eftAtkedCri.playFrame(false,this)}}else{if(this.eftAtked){this.eftAtked.playFrame(false,this)}}}setHp(hp){this.hp+=hp;this.hp=this.hp<0?0:this.hp;this.hpBar.value=this.hp/this.hpMax;if(this.hp==0&&this.curActionState!=king_1.ActionState.DEAD){this.setActionType(this.isAtkedCri?king_1.ActionType.DEADCRIT:king_1.ActionType.DEAD);this.onDead()}}setPosition(x,y){this.x=x;this.y=y;this.startPoint.setTo(x,y)}get atk(){return this.atkBasic+this.atkEquip+this.atkSkill}get atkedPoint(){return this._atkedPoint.setTo(this.startPoint.x+this.atkedX,this.startPoint.y+this.atkedY)}onDead(){if(this.eftDead){this.eftDead.playFrame(false,this)}}onDeadDisappear(){king_1.KingManager.ins.removeKing(this.objId)}getRandAtkIndex(){if(this.atkIndex>=this.arrAtkId.length){this.atkIndex=0}return this.arrAtkId[this.atkIndex++]}getAtkingEftRotation(atkingX=0,atkingY=0){let dirRotation=0;switch(this.curDirect){case king_1.ActionDirect.Up:dirRotation=-90;break;case king_1.ActionDirect.Right_up:dirRotation=-45;break;case king_1.ActionDirect.Right:dirRotation=0;break;case king_1.ActionDirect.Right_down:dirRotation=45;break;case king_1.ActionDirect.Down:dirRotation=90;break;case king_1.ActionDirect.Left_down:dirRotation=135;break;case king_1.ActionDirect.Left:dirRotation=180;break;case king_1.ActionDirect.Left_up:dirRotation=-135;break;default:break}if(game.Define.gameType!=game.GameType.over_look&&this.atkTarget){let angle=MathUtil.getTwoPointAngle(this.x+atkingX,this.y+atkingY,this.atkTarget.x+this.atkTarget.atkedX,this.atkTarget.y+this.atkTarget.atkedY);return MathUtil.getFromAngle(angle)}return this.spBody.rotation+dirRotation}reset(){this.curActionState=king_1.ActionState.NONE;this.curActionType=king_1.ActionType.Wait;this.hpBar.visible=true;this.rotation=0;this.alpha=1;this.dicCD=new Dictionary;this.curFixedIndex=0}}king_1.King=King})(king=scene.king||(scene.king={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var king;(function(king){class Npc extends king.BaseKing{constructor(){super();this.atkDistance=1;this.moveSpeed=1;this.curPointIndex=0;this.isMoveLoop=true;this.hpBar=new Laya.ProgressBar;this.hpBar.anchorX=this.hpBar.anchorY=.5;this.spHead.addChild(this.hpBar);this.spDebug=new Laya.Sprite;this.addChild(this.spDebug);this.startPoint=new Laya.Point;this.endPoint=new Laya.Point}init(){super.init()}setSkin(skinData,isAdd=true){super.setSkin(skinData,isAdd)}update(){this.startPoint.setTo(this.x,this.y)}setMovePoint(arr){this.arrPoint=arr;this.curPointIndex=0;this.nextPoint()}move(){if(game.Define.gameType==game.GameType.over_look){let angle=MathUtil.getTwoPointAngle(this.x,this.y,this.atkTarget.x,this.atkTarget.y);this.spBody.rotation=MathUtil.getFromAngle(angle);let radian=MathUtil.angleToRadian(this.spBody.rotation);this.x+=Math.cos(radian)*this.moveSpeed;this.y+=Math.sin(radian)*this.moveSpeed;this.endPoint.setTo(this.atkTarget.x,this.atkTarget.y);let distance=MathUtil.getDistance(this.startPoint,this.endPoint);if(distance<this.atkDistance){this.setActionState(king.ActionState.ATTACK)}}else if(game.Define.gameType==game.GameType.h_game){if(!this.curPoint){return}this.x<this.curPoint.x?this.setActionDirect(king.ActionDirect.Right):this.x>this.curPoint.x?this.setActionDirect(king.ActionDirect.Left):null;if(this.curDirect==king.ActionDirect.Left){if(this.x-this.moveSpeed-this.atkDistance>this.curPoint.x){this.pos(this.x-this.moveSpeed,this.y)}else{this.nextPoint()}}else if(this.curDirect==king.ActionDirect.Right){if(this.x+this.moveSpeed+this.atkDistance<this.curPoint.x){this.pos(this.x+this.moveSpeed,this.y)}else{this.nextPoint()}}else{}}else if(game.Define.gameType==game.GameType.v_game){}else{}}nextPoint(){if(this.curPointIndex>=this.arrPoint.length){if(this.isMoveLoop){this.curPointIndex=0}else{return null}}this.curPoint=this.arrPoint[this.curPointIndex];this.curPointIndex++;return this.curPoint}checkMoveDir(fromX,fromY,toX,toY,isEightDir=true){let radian=Math.atan2(fromY-toY,fromX-toX);let angle=MathUtil.radianToAngle(radian);if(isEightDir){return 0}else{return angle}}onDead(){if(this.eftDead){this.eftDead.playFrame(false,this)}}onDeadDisappear(){king.NpcManager.ins.removeNpc(this.objId)}reset(){this.curActionState=king.ActionState.NONE;this.curActionType=king.ActionType.Wait;this.hpBar.visible=true;this.rotation=0;this.alpha=1}}king.Npc=Npc})(king=scene.king||(scene.king={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var skill;(function(skill){var BaseDisplay=game.display.BaseDisplay;class BaseSkill extends BaseDisplay{constructor(){super();this.startPoint=new Laya.Point;this.endPoint=new Laya.Point;this.curPoint=new Laya.Point}setData(skillData){this.skillData=skillData;this.cfgSkill=skillData.cfg_Skill;this.atkTarget=skillData.atkTarget;this.atkedTarget=skillData.atkedTarget;if(this.atkTarget){this.atkTarget.atkSkill=this.cfgSkill?this.cfgSkill.atk:0;this.atkTarget.atkTarget=this.atkedTarget}this.atkEft=FrameManager.ins.getFrame(this.cfgSkill.atkEft,Laya.Handler.create(this,this.atkCallBack,null,false));if(this.atkEft)this.atkEft.name="atkEft";this.atkingEft=FrameManager.ins.getFrame(this.cfgSkill.atkingEft,Laya.Handler.create(this,null,null,false));this.atkedEft=FrameManager.ins.getFrame(this.cfgSkill.atkedEft,Laya.Handler.create(this,this.atkedCallBack,null,false))}play(){console.log("子类未实现")}stop(){}atkCallBack(){}atkingCallBack(){}atkedCallBack(){}}skill.BaseSkill=BaseSkill;class SkillData{constructor(Cfg_Skill,atkTarget,atkedTarget){this.cfg_Skill=Cfg_Skill;this.atkTarget=atkTarget;this.atkedTarget=atkedTarget}}skill.SkillData=SkillData;let SkillType;(function(SkillType){SkillType[SkillType["ATTACK"]=0]="ATTACK";SkillType[SkillType["BULLET"]=1]="BULLET";SkillType[SkillType["GROUP_SKILL"]=2]="GROUP_SKILL"})(SkillType=skill.SkillType||(skill.SkillType={}))})(skill=scene.skill||(scene.skill={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var skill;(function(skill){class AttackSkill extends skill.BaseSkill{constructor(){super()}setData(skillData){super.setData(skillData)}play(){if(this.atkTarget){if(this.atkEft){this.atkEft.x=this.cfgSkill.atkX;this.atkEft.y=this.cfgSkill.atkY;this.atkEft.playFrame(false,this.atkTarget.spBody)}else{this.atkCallBack()}}}atkCallBack(){if(this.atkedTarget&&this.atkedTarget.curActionState!=ActionState.DEAD){if(this.atkedEft){this.atkedEft.x=this.atkedTarget.atkedX;this.atkedEft.y=this.atkedTarget.atkedY;this.atkedEft.playFrame(false,this.atkedTarget.spEft)}if(this.cfgSkill.atkedDelay>0){Laya.timer.once(this.cfgSkill.atkedDelay,this,()=>{this.atkedTarget.attacked(this.atkTarget)})}else{this.atkedTarget.attacked(this.atkTarget)}}}}skill.AttackSkill=AttackSkill})(skill=scene.skill||(scene.skill={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var skill;(function(skill){class BulletSkill extends skill.BaseSkill{constructor(){super();this._autoCheck=false;Laya.timer.frameLoop(1,this,this.update);this.arrBullet=[]}setData(skillData){super.setData(skillData);if(skillData&&skillData.cfg_Skill){if(!skillData.cfg_Skill.atkDistance||skillData.cfg_Skill.atkDistance==0)console.error("技能ID:"+skillData.cfg_Skill.skillId+" 子弹攻击距离atkDistance为0，请检查技能表配置");if(!skillData.cfg_Skill.atkingSpeed||skillData.cfg_Skill.atkingSpeed==0)console.error("技能ID:"+skillData.cfg_Skill.skillId+" 子弹飞行速度atkingSpeed为0，请检查技能表配置")}}play(){if(this.atkTarget){if(this.atkEft){this.atkEft.x=this.cfgSkill.atkX;this.atkEft.y=this.cfgSkill.atkY;this.atkEft.playFrame(false,this.atkTarget.spBody)}if(this.atkingEft){let bulletCount=this.cfgSkill.atkingCount;let bulletRotation=this.cfgSkill.atkingRotation;let minRotation=this.atkTarget.getAtkingEftRotation(this.cfgSkill.atkingX,this.cfgSkill.atkingY)-(bulletRotation>>1);let addRotation=0;if(bulletCount>1){addRotation=bulletRotation/(bulletCount-1)}let bf=null;for(let i=0;i<bulletCount;i++){bf=FrameManager.ins.getFrame(this.cfgSkill.atkingEft,Laya.Handler.create(this,null,null,false));this.createBullet(bf,minRotation+addRotation*i);this.arrBullet.push(bf)}}}}createBullet(bullet,rotation){bullet.rotation=rotation;let radian=MathUtil.angleToRadian(bullet.rotation);if(game.Define.gameType==game.GameType.over_look){bullet.x=this.atkTarget.x+this.cfgSkill.atkingX*Math.cos(radian);bullet.y=this.atkTarget.y+this.cfgSkill.atkingX*Math.sin(radian)}else{bullet.x=this.atkTarget.x+this.cfgSkill.atkingX;bullet.y=this.atkTarget.y+this.cfgSkill.atkingY}bullet.playFrame(true,scene.LayerName.scene_effect);this._autoCheck=true;this.atkedTarget=null;let toX=bullet.x+this.cfgSkill.atkDistance*Math.cos(radian);let toY=bullet.y+this.cfgSkill.atkDistance*Math.sin(radian);this.startPoint.setTo(bullet.x,bullet.y);this.endPoint.setTo(toX,toY);let distance=MathUtil.getDistance(this.startPoint,this.endPoint);Laya.Tween.to(bullet,{x:toX,y:toY,scaleX:.6,scaleY:.6},distance*this.cfgSkill.atkingSpeed/100,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.atkingFinish(bullet,this.atkedTarget)}))}update(){if(this._autoCheck){let distance=0;let bulletCount=0;for(let bullet of this.arrBullet){if(bullet.parent){bulletCount++}else{continue}this.curPoint.setTo(bullet.x,bullet.y);for(let enemy of KingManager.ins.kings){if(enemy.curActionState!=ActionState.DEAD&&this.atkTarget.camp!=enemy.camp){distance=MathUtil.getDistance(enemy.atkedPoint,this.curPoint);if(distance<enemy.atkedRadis){Laya.Tween.clearAll(bullet);this.atkingFinish(bullet,enemy);break}}}}if(bulletCount==0){this._autoCheck=false}}}atkCallBack(){}atkingFinish(bullet,enemy=null){if(this.atkEft)this.atkEft.stopFrame();if(bullet)bullet.stopFrame();if(enemy){this.atkedEft=FrameManager.ins.getFrame(this.cfgSkill.atkedEft,null);if(this.atkedEft){this.atkedEft.x=enemy.atkedX;this.atkedEft.y=enemy.atkedY;this.atkedEft.playFrame(false,enemy.spEft)}enemy.attacked(this.atkTarget)}}atkedCallBack(){}}skill.BulletSkill=BulletSkill})(skill=scene.skill||(scene.skill={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){var skill;(function(skill){class GroupKillSkill extends skill.BaseSkill{constructor(){super()}setData(skillData){super.setData(skillData)}play(){if(this.atkTarget){if(this.atkEft){this.atkEft.x=this.cfgSkill.atkX;this.atkEft.y=this.cfgSkill.atkY;this.atkEft.playFrame(false,this.atkTarget.spBody)}if(this.atkingEft){this.atkingEft.rotation=this.atkTarget.rotation;let radian=MathUtil.angleToRadian(this.atkingEft.rotation);this.atkingEft.x=this.atkTarget.x+this.cfgSkill.atkingX*Math.cos(radian);this.atkingEft.y=this.atkTarget.y+this.cfgSkill.atkingX*Math.sin(radian);this.atkingEft.playFrame(true,scene.LayerName.scene_effect);let toX=this.atkedTarget?this.atkedTarget.x:this.atkTarget.x+game.Define.DeviceW*Math.cos(radian);let toY=this.atkedTarget?this.atkedTarget.y:this.atkTarget.y+game.Define.DeviceW*Math.sin(radian);this.startPoint.setTo(this.atkingEft.x,this.atkingEft.y);this.endPoint.setTo(toX,toY);let distance=MathUtil.getDistance(this.startPoint,this.endPoint);Laya.Tween.to(this.atkingEft,{x:toX,y:toY},distance*this.cfgSkill.atkingSpeed/100,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{if(this.atkEft)this.atkEft.stopFrame();if(this.atkingEft)this.atkingEft.stopFrame();if(this.atkedTarget){if(this.atkedEft){this.atkedEft.x=this.atkedTarget.spBody.pivotX+this.atkedTarget.atkedX;this.atkedEft.y=this.atkedTarget.spBody.pivotY+this.atkedTarget.atkedY;this.atkedEft.playFrame(false,this.atkedTarget.spBody)}this.atkedTarget.setHp(-this.cfgSkill.atk)}}))}else{let distance=0;for(let king of KingManager.ins.kings){if(king.curActionState!=ActionState.DEAD){distance=king.startPoint.distance(this.atkTarget.x,this.atkTarget.y);if(this.cfgSkill.atkDistance==0||distance<this.cfgSkill.atkDistance){king.setHp(-this.cfgSkill.atk)}}}}}}}skill.GroupKillSkill=GroupKillSkill})(skill=scene.skill||(scene.skill={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){var BaseUI=game.display.BaseUI;class BaseWindow extends BaseUI{constructor(viewCls){super();this.uiType=null;this.view=null;this.view=new viewCls;this.root=LayerManager.ins.getLayer(LayerName.root);this.addChild(this.view)}init(){}open(delayTime=0){this.view.on(Laya.Event.CLICK,this,this.mouseClick);if(this.uiType){ui.UIScaleManager.ins.regUI(this.uiType.name,()=>{this.scaleH()},()=>{this.scaleV()})}if(delayTime>0){let sp=new Sprite;sp.graphics.drawRect(0,0,game.Define.DeviceW,game.Define.DeviceH,"#ffffff");Laya.stage.addChild(sp);Laya.timer.once(delayTime,this,()=>{sp.removeSelf()})}}close(){this.view.off(Laya.Event.CLICK,this,this.mouseClick);ui.UIScaleManager.ins.regUI(this.uiType.name,null,null)}mouseClick(event){event.stopPropagation();let btn=event.target;if(btn instanceof Laya.Sprite){if(btn.name==""||btn instanceof BaseWindow||btn instanceof Laya.Box||btn instanceof Laya.ProgressBar||btn instanceof Laya.ScrollBar||btn instanceof Laya.Slider||btn instanceof Laya.ComboBox){}else{if(btn instanceof Laya.Button){Laya.Tween.from(btn,{scaleX:.8,scaleY:.8},80)}this.viewClick(btn)}}}viewClick(sp){let spName=sp.name;switch(spName){case"btnClose":ui.UIManager.ins.closeWindow(this.uiType);break;default:break}}}ui.BaseWindow=BaseWindow})(ui=game.ui||(game.ui={}))})(game||(game={}));var View=Laya.View;var Dialog=Laya.Dialog;var ui;(function(ui){var game;(function(game){class GameUI extends View{constructor(){super()}createChildren(){super.createChildren();this.createView(ui.game.GameUI.uiView)}}GameUI.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:0,x:0,var:"imgBg",name:"imgBg"}},{type:"Button",props:{y:17,x:19,var:"btnBack",stateNum:1,skin:"game/btn_fh.png",name:"btnBack"}},{type:"Label",props:{y:37,x:167,width:134,var:"txtScoe",text:"0",name:"txtScoe",height:40,fontSize:40,color:"#ffffff",align:"left"}},{type:"Image",props:{y:577,width:100,var:"imgEfct",name:"imgEfct",height:50,centerX:0,anchorY:.5,anchorX:.5}}]};game.GameUI=GameUI})(game=ui.game||(ui.game={}))})(ui||(ui={}));(function(ui){var game;(function(game){class GameOverUI extends View{constructor(){super()}createChildren(){super.createChildren();this.createView(ui.game.GameOverUI.uiView)}}GameOverUI.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Sprite",props:{width:720,height:1280,alpha:.5},child:[{type:"Rect",props:{width:720,lineWidth:1,height:1280,fillColor:"#000000"}}]},{type:"Image",props:{y:434,width:600,skin:"common/bg.png",sizeGrid:"40,4,4,4",height:400,centerX:0}},{type:"Button",props:{y:438,x:628,var:"btnClose",skin:"common/btn_close.png",name:"btnClose"}},{type:"Label",props:{y:437,text:"游戏结束",fontSize:24,color:"#ffffff",centerX:0}},{type:"Button",props:{y:665,x:158,width:177,var:"btnAgin",skin:"common/button.png",name:"btnAgin",labelSize:40,label:"再来一次",height:77}},{type:"Button",props:{y:661,x:388,width:177,var:"btnMain",skin:"common/button.png",name:"btnMain",labelSize:40,label:"返回主页",height:77}},{type:"Label",props:{y:531,x:207,text:"本次得分",fontSize:24,font:"SimSun",color:"#000000"}},{type:"Label",props:{y:531,x:369,width:100,var:"txtScore",text:"0",fontSize:24,font:"SimSun",color:"#000000"}},{type:"Label",props:{y:576,x:207,text:"最高得分",fontSize:24,font:"SimSun",color:"#000000"}},{type:"Label",props:{y:576,x:369,width:100,var:"txtScoreMax",text:"0",fontSize:24,font:"SimSun",color:"#000000"}}]};game.GameOverUI=GameOverUI})(game=ui.game||(ui.game={}))})(ui||(ui={}));(function(ui){class LoadingUI extends View{constructor(){super()}createChildren(){View.regComponent("Text",Laya.Text);super.createChildren();this.createView(ui.LoadingUI.uiView)}}LoadingUI.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:0,x:0,width:720,var:"imgBg",height:1280}},{type:"Image",props:{y:306,width:190,var:"imgLogo",name:"imgLogo",height:190,centerX:0}},{type:"Text",props:{y:1153,x:0,wordWrap:true,width:736,text:"抵制不良游戏 拒绝盗版游戏 注意自我保护 谨防受骗上当 适度游戏益脑 沉迷游戏伤身 合理安排时间 享受健康生活",leading:15,height:93,fontSize:28,font:"SimSun",color:"#000000",bold:false,align:"left"}},{type:"ProgressBar",props:{y:1004,x:74,width:500,var:"bar",height:30}},{type:"Label",props:{y:520,width:341,text:"乐帆游戏 快乐远行",height:54,fontSize:40,font:"SimSun",color:"#000000",centerX:0}}]};ui.LoadingUI=LoadingUI})(ui||(ui={}));(function(ui){var main;(function(main){class BagUI extends View{constructor(){super()}createChildren(){super.createChildren();this.createView(ui.main.BagUI.uiView)}}BagUI.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Sprite",props:{width:720,height:1280,alpha:.5},child:[{type:"Rect",props:{width:720,lineWidth:1,height:1280,fillColor:"#000000"}}]},{type:"Image",props:{y:434,width:600,skin:"common/bg.png",sizeGrid:"40,4,4,4",height:400,centerX:0}},{type:"Button",props:{y:439,x:576,var:"btnClose",skin:"common/btn_close.png",name:"btnClose"}},{type:"Label",props:{y:437,x:340,text:"背包",fontSize:24}}]};main.BagUI=BagUI})(main=ui.main||(ui.main={}))})(ui||(ui={}));(function(ui){var main;(function(main){class MainUI extends View{constructor(){super()}createChildren(){super.createChildren();this.createView(ui.main.MainUI.uiView)}}MainUI.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Image",props:{y:0,x:0,width:720,var:"imgBg",height:1280}},{type:"Button",props:{y:961,x:45,width:177,var:"btnBag",skin:"common/button.png",name:"btnBag",labelSize:40,label:"背包",height:77}},{type:"Button",props:{y:852,x:255,width:177,var:"btnStart",skin:"common/button.png",name:"btnStart",labelSize:40,label:"开始游戏",height:77}},{type:"Button",props:{y:963,x:257,width:177,var:"btnShare",skin:"common/button.png",name:"btnShare",labelSize:40,label:"分享",height:77}},{type:"Button",props:{y:961,x:482,width:177,var:"btnRank",skin:"common/button.png",name:"btnRank",labelSize:40,label:"排行榜",height:77}}]};main.MainUI=MainUI})(main=ui.main||(ui.main={}))})(ui||(ui={}));(function(ui){var main;(function(main){class RankUI extends View{constructor(){super()}createChildren(){super.createChildren();this.createView(ui.main.RankUI.uiView)}}RankUI.uiView={type:"View",props:{width:720,height:1280},child:[{type:"Sprite",props:{width:720,height:1280,alpha:.5},child:[{type:"Rect",props:{width:720,lineWidth:1,height:1280,fillColor:"#000000"}}]},{type:"Image",props:{y:234,width:600,skin:"common/bg.png",sizeGrid:"40,4,4,4",height:700,centerX:0}},{type:"Button",props:{y:238,x:625,var:"btnClose",skin:"common/btn_close.png",name:"btnClose"}},{type:"Label",props:{y:238,x:334,text:"排行榜",fontSize:24,color:"#000000"}}]};main.RankUI=RankUI})(main=ui.main||(ui.main={}))})(ui||(ui={}));var game;(function(game){var LangType=game.platform.LangType;var ScreenFillType=game.scene.ScreenFillType;let GameType;(function(GameType){GameType[GameType["default"]=0]="default";GameType[GameType["over_look"]=1]="over_look";GameType[GameType["h_game"]=2]="h_game";GameType[GameType["v_game"]=3]="v_game";GameType[GameType["rpg"]=4]="rpg"})(GameType=game.GameType||(game.GameType={}));class Define{constructor(){}}Define.isDebug=true;Define.clientWidth=360;Define.clientHeight=640;Define.pixelRatio=3;Define.width=1080;Define.height=1920;Define.DeviceW=720;Define.DeviceH=1280;Define.canvasWidth=1080;Define.canvasHeight=1280;Define.CDN="res";Define.serverHttp="http://127.0.0.1";Define.serverIP="http://127.0.0.1";Define.serverPort="3000";Define.serverConfigUrl="res/config/serverConfig.json";Define.gameId=1;Define.gameVersion="100";Define.langId=LangType.Zh;Define.isLocal=true;Define.screenMode=0;Define.isVertitalGame=true;Define.isVertitalState=true;Define.isSameScale=false;Define.isSameBackgroundScale=true;Define.screenFillType=ScreenFillType.default;Define.gameType=GameType.default;Define.appId="wx659ae0df220d382f";Define.SOUND_BTN="";Define.SOUND_MAIN=null;Define.DOWNLOAD_URL="";Define.BACKGROUND_COLOR="";game.Define=Define;class AdConfig{constructor(){}}game.AdConfig=AdConfig})(game||(game={}));var game;(function(game){var PlatformID=game.platform.PlatformID;class Global{constructor(){}}Global.platformId=PlatformID.None;game.Global=Global})(game||(game={}));console.log("game.core version: 2020-11-27 1.0.0");var Define=game.Define;var Global=game.Global;var GameType=game.GameType;var EventManager=game.common.EventManager;var NoticeEvent=game.common.NoticeEvent;var ResManager=game.common.ResManager;var SoundManager=game.common.SoundManager;var TipManager=game.common.TipManager;var OpenManager=game.common.OpenManager;var TweenManager=game.common.TweenManager;var TweenTarget=game.common.TweenTarget;var TweenProp=game.common.TweenProp;var TweenPropType=game.common.TweenPropType;var BaseDisplay=game.display.BaseDisplay;var BaseUI=game.display.BaseUI;var BaseAnimation=game.display.BaseAnimation;var BaseWindow=game.ui.BaseWindow;var UIManager=game.ui.UIManager;var UIScaleManager=game.ui.UIScaleManager;var UIType=game.ui.UIType;var BaseFrame=game.effect.BaseFrame;var FrameManager=game.effect.FrameManager;var BaseEffect=game.effect.BaseEffect;var BaseEffectData=game.effect.BaseEffectData;var EffectManager=game.effect.EffectManager;var EffectName=game.effect.EffectName;var BossWarningEft=game.effect.BossWarningEft;var BossWarningData=game.effect.BossWarningData;var GuideClickEft=game.effect.GuideClickEft;var GuideClickData=game.effect.GuideClickData;var FountainEft=game.effect.FountainEft;var FountainData=game.effect.FountainData;var ChangeImageEft=game.effect.ChangeImageEft;var ChangeImageData=game.effect.ChangeImageData;var OutGoldEft=game.effect.OutGoldEft;var OutGoldData=game.effect.OutGoldData;var AirDropEft=game.effect.AirDropEft;var AirDropData=game.effect.AirDropData;var WaitingEft=game.effect.WaitingEft;var WaitingData=game.effect.WaitingData;var OutStarEft=game.effect.OutStarEft;var OutStarData=game.effect.OutStarData;var LayerManager=game.scene.LayerManager;var LayerName=game.scene.LayerName;var SceneManager=game.scene.SceneManager;var ScreenFillType=game.scene.ScreenFillType;var Scene3DManager=game.scene.Scene3DManager;var TouchManager=game.scene.TouchManager;var RockerManager=game.scene.RockerManager;var BaseKing=game.scene.king.BaseKing;var SkinData=game.scene.king.SkinData;var Action=game.scene.king.Action;var King=game.scene.king.King;var Npc=game.scene.king.Npc;var KingManager=game.scene.king.KingManager;var NpcManager=game.scene.king.NpcManager;var ActionType=game.scene.king.ActionType;var ActionDirect=game.scene.king.ActionDirect;var ActionState=game.scene.king.ActionState;var BaseBone=game.scene.king.BaseBone;var BoneManager=game.scene.king.BoneManager;var BaseSkill=game.scene.skill.BaseSkill;var SkillData=game.scene.skill.SkillData;var SkillType=game.scene.skill.SkillType;var SkillManager=game.scene.skill.SkillManager;var NetManager=game.net.NetManager;var SocketIoEvent=game.net.SocketIoEvent;var HttpManager=game.net.HttpManager;var Base64Manager=game.base64.Base64Manager;var Base64Type=game.base64.Base64Type;var MathUtil=game.util.MathUtil;var Size=game.util.Size;var PubUtil=game.util.PubUtil;var Dictionary=game.util.Dictionary;var PlatformManager=game.platform.PlatformManager;var PlatformID=game.platform.PlatformID;var LangType=game.platform.LangType;var PlatformAction=game.platform.PlatformAction;var LocalPlatform=game.platform.LocalPlatform;var WxPlatform=game.platform.WxPlatform;var FaceBookPlatform=game.platform.FaceBookPlatform;var ApplovinPlatform=game.platform.ApplovinPlatform;var IronSourcePlatform=game.platform.IronSourcePlatform;var UnityPlatform=game.platform.UnityPlatform;var GooglePlatform=game.platform.GooglePlatform;var MTGPlatform=game.platform.MTGPlatform;var VunglePlatform=game.platform.VunglePlatform;var AdColonyPlatform=game.platform.AdColonyPlatform;var Cfg_Skill=game.config.Cfg_Skill;var Cfg_Frame=game.config.Cfg_Frame;var Cfg_Action=game.config.Cfg_Action;var Cfg_Item=game.config.Cfg_Item;var Cfg_Level=game.config.Cfg_Level;var Cfg_Monster=game.config.Cfg_Monster;var Cfg_Npc=game.config.Cfg_Npc;var Stage=Laya.Stage;var Render=Laya.Render;var Sprite=Laya.Sprite;var EventData=Laya.EventData;var Skeleton=Laya.Skeleton;var Templet=Laya.Templet;var Browser=Laya.Browser;var Handler=Laya.Handler;var Stat=Laya.Stat;var Tween=Laya.Tween;var WebGL=Laya.WebGL;